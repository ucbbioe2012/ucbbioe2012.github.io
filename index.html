<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anesthesiology Resident Quick Guide</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            -webkit-user-select: none; /* Safari */
            -ms-user-select: none; /* IE 10+ */
            user-select: none; /* Standard syntax */
        }
        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        /* Style for the PACU content to render markdown-like headers */
        .pacu-content h1 { font-size: 1.5rem; font-weight: 700; margin-top: 1.5rem; margin-bottom: 0.5rem; border-bottom: 1px solid #e2e8f0; padding-bottom: 0.25rem; }
        .pacu-content h2 { font-size: 1.25rem; font-weight: 600; margin-top: 1.25rem; margin-bottom: 0.5rem; }
        .pacu-content h3 { font-size: 1.1rem; font-weight: 600; margin-top: 1rem; margin-bottom: 0.5rem; }
        .pacu-content p { margin-bottom: 0.75rem; line-height: 1.6; }
        .pacu-content ul { list-style-type: disc; margin-left: 1.5rem; margin-bottom: 0.75rem; }
        .pacu-content table { width: 100%; border-collapse: collapse; margin-bottom: 1rem; }
        .pacu-content th, .pacu-content td { border: 1px solid #cbd5e1; padding: 0.5rem; text-align: left; }
        .pacu-content th { background-color: #f1f5f9; }
        
        /* --- Flippable Roller Styles --- */
        .roller-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .roller-flipper {
            position: relative;
            height: 60px;
            width: 90px;
            perspective: 500px;
            cursor: ns-resize;
        }
        .roller-flipper.disabled {
            cursor: not-allowed;
            opacity: 0.6;
        }
        .roller-card {
            position: absolute;
            width: 100%;
            height: 100%;
            font-size: 2.25rem;
            font-weight: 700;
            line-height: 60px;
            text-align: center;
            background-color: #f9fafb;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            backface-visibility: hidden; /* Important for clean flips */
        }
        .roller-label {
            margin-top: 0.5rem;
            font-size: 0.875rem;
            font-weight: 500;
            color: #4b5563;
        }

        /* Animation Setup */
        .roller-top {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 50%;
            overflow: hidden;
            border-top-left-radius: 0.5rem;
            border-top-right-radius: 0.5rem;
        }
        .roller-bottom {
            position: absolute;
            top: 50%; left: 0;
            width: 100%; height: 50%;
            overflow: hidden;
            border-bottom-left-radius: 0.5rem;
            border-bottom-right-radius: 0.5rem;
        }
        .roller-bottom span {
            display: block;
            transform: translateY(-50%);
        }

        .roller-flipper.animating .before .roller-top {
            transform-origin: bottom center;
            animation: flip-up-top 0.3s ease-in forwards;
        }
        .roller-flipper.animating .after .roller-bottom {
            transform-origin: top center;
            transform: rotateX(90deg);
            animation: flip-up-bottom 0.3s ease-in-out 0.3s forwards;
        }
        
        @keyframes flip-up-top {
            to { transform: rotateX(-90deg); }
        }
        @keyframes flip-up-bottom {
            from { transform: rotateX(90deg); }
            to { transform: rotateX(0deg); }
        }
    </style>
</head>
<body class="bg-gray-100">

    <div class="flex flex-col md:flex-row min-h-screen">
        <!-- Sidebar -->
        <aside class="w-full md:w-64 bg-gray-800 text-white flex-shrink-0">
            <div class="p-4">
                <h1 class="text-xl font-bold text-center md:text-left">Anesco Guide</h1>
                <p class="text-sm text-gray-400 text-center md:text-left">Resident Quick Reference</p>
            </div>
             <nav class="w-full">
                <div class="flex flex-row md:flex-col">
                    <!-- Tab buttons -->
                    <button id="peds-tab-btn" class="flex-grow text-center p-3 md:p-4 md:text-left border-b-4 md:border-b-0 md:border-l-4 border-indigo-500 text-white bg-gray-700 hover:bg-gray-600 focus:outline-none transition-colors duration-200">
                        Pediatric Calculator
                    </button>
                    <button id="pacu-tab-btn" class="flex-grow text-center p-3 md:p-4 md:text-left border-b-4 md:border-b-0 md:border-l-4 border-transparent text-gray-300 hover:text-white hover:bg-gray-600 focus:outline-none transition-colors duration-200">
                        PACU Management
                    </button>
                </div>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 p-4 md:p-8 overflow-y-auto">
            
            <!-- Pediatric Calculator Content -->
            <div id="peds-content">
                <h2 class="text-xl md:text-2xl font-bold mb-6 text-gray-800">Pediatric Anesthesia Calculator</h2>
                
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 items-center">
                        <div id="age-roller-container" class="roller-container"></div>
                        <div id="weight-roller-container" class="roller-container"></div>
                        <div id="height-roller-container" class="roller-container"></div>
                    </div>

                    <div class="flex justify-center mt-4">
                         <div class="flex items-center">
                            <input id="preterm-checkbox" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                            <label for="preterm-checkbox" class="ml-2 block text-sm text-gray-900">Preterm</label>
                        </div>
                        <div class="ml-4">
                             <select id="age-unit" class="rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                                <option value="years">Years</option>
                                <option value="months">Months</option>
                            </select>
                        </div>
                    </div>

                    <div class="mt-6 text-right">
                        <button id="calculate-btn" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                            Calculate
                        </button>
                    </div>
                </div>

                <div id="results" class="mt-8 hidden">
                    <h3 class="text-lg md:text-xl font-bold mb-4 text-gray-800">Results</h3>
                    <div class="bg-white p-6 rounded-lg shadow-md mb-6">
                        <h4 class="text-base md:text-lg font-semibold text-gray-700 mb-4">Airway Equipment</h4>
                        <div id="airway-results" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-4">
                            <!-- Airway results will be inserted here -->
                        </div>
                    </div>
                     <div class="bg-white p-6 rounded-lg shadow-md mb-6">
                        <h4 class="text-base md:text-lg font-semibold text-gray-700 mb-4">Vitals</h4>
                        <div id="vitals-results" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-4">
                            <!-- Vitals results will be inserted here -->
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h4 class="text-base md:text-lg font-semibold text-gray-700 mb-4">Medication Dosages</h4>
                        <div class="overflow-x-auto">
                            <table id="med-table" class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Medication</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Calculated Dose</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Dose Range</th>
                                    </tr>
                                </thead>
                                <tbody id="med-table-body" class="bg-white divide-y divide-gray-200">
                                    <!-- Rows will be inserted here by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

            </div>

            <!-- PACU Management Content -->
            <div id="pacu-content" class="hidden">
                <h2 class="text-xl md:text-2xl font-bold mb-6 text-gray-800">PACU Symptom Management</h2>
                
                <div class="relative bg-white p-6 rounded-lg shadow-md">
                    <label for="pacu-search" class="block text-sm font-medium text-gray-700">Search for a symptom</label>
                    <input type="text" id="pacu-search" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm" placeholder="e.g., Hypertension, Hypoxia, Shivering...">
                    <div id="suggestions-box" class="absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg hidden">
                        <!-- Suggestions will be populated here -->
                    </div>
                </div>

                <div id="pacu-result-display" class="mt-8 bg-white p-6 rounded-lg shadow-md hidden">
                    <!-- Selected symptom content will be displayed here -->
                </div>
            </div>
        </main>
    </div>

    <script>
        const App = {
            // --- INITIALIZATION ---
            init() {
                this.cacheDOMElements();
                this.setupTabSwitching();
                this.PedsCalculator.init();
                this.PacuManager.init();
            },

            // --- DOM ELEMENT CACHING ---
            cacheDOMElements() {
                this.dom = {
                    pedsTabBtn: document.getElementById('peds-tab-btn'),
                    pacuTabBtn: document.getElementById('pacu-tab-btn'),
                    pedsContent: document.getElementById('peds-content'),
                    pacuContent: document.getElementById('pacu-content'),
                };
            },

            // --- TAB SWITCHING LOGIC ---
            setupTabSwitching() {
                this.dom.pedsTabBtn.addEventListener('click', () => {
                    this.dom.pedsContent.classList.remove('hidden');
                    this.dom.pacuContent.classList.add('hidden');
                    this.updateTabStyles(this.dom.pedsTabBtn);
                });

                this.dom.pacuTabBtn.addEventListener('click', () => {
                    this.dom.pacuContent.classList.remove('hidden');
                    this.dom.pedsContent.classList.add('hidden');
                    this.updateTabStyles(this.dom.pacuTabBtn);
                });
            },
            
            updateTabStyles(activeButton) {
                [this.dom.pedsTabBtn, this.dom.pacuTabBtn].forEach(button => {
                    button.classList.remove('border-indigo-500', 'text-white', 'bg-gray-700');
                    button.classList.add('border-transparent', 'text-gray-300');
                });
                activeButton.classList.add('border-indigo-500', 'text-white', 'bg-gray-700');
                activeButton.classList.remove('border-transparent', 'text-gray-300');
            },

            // --- ROLLER FACTORY ---
            RollerFactory: {
                create(containerId, options) {
                    const { label, min, max, initial, step = 1, unit = '' } = options;
                    const container = document.getElementById(containerId);
                    
                    container.innerHTML = `
                        <div class="roller-flipper" id="${containerId}-flipper">
                            <div class="roller-card before" id="${containerId}-before"></div>
                            <div class="roller-card after" id="${containerId}-after"></div>
                        </div>
                        <span class="roller-label">${label}</span>
                    `;

                    const flipper = document.getElementById(`${containerId}-flipper`);
                    const beforeCard = document.getElementById(`${containerId}-before`);
                    const afterCard = document.getElementById(`${containerId}-after`);

                    let currentValue = initial;
                    let isDragging = false;
                    let startY = 0;
                    let isEnabled = true;
                    let isAnimating = false;
                    
                    const formatValue = (val) => `${val.toFixed(step < 1 ? 1 : 0)}${unit}`;
                    
                    const createCardContent = (value) => `
                        <div class="roller-top"><span>${formatValue(value)}</span></div>
                        <div class="roller-bottom"><span>${formatValue(value)}</span></div>
                    `;

                    const setValue = (val, animate = false) => {
                        if (isAnimating) return;
                        const newValue = Math.round(Math.max(min, Math.min(max, val)) / step) * step;
                        if (newValue === currentValue && !animate) {
                           beforeCard.innerHTML = createCardContent(currentValue);
                           afterCard.innerHTML = '';
                           return;
                        }
                        
                        if (animate) {
                           isAnimating = true;
                           
                           const beforeValue = currentValue;
                           const afterValue = newValue;

                           beforeCard.innerHTML = createCardContent(beforeValue);
                           afterCard.innerHTML = createCardContent(afterValue);
                           
                           flipper.classList.add('animating');
                           
                           flipper.addEventListener('animationend', () => {
                               currentValue = newValue;
                               beforeCard.innerHTML = createCardContent(currentValue);
                               flipper.classList.remove('animating');
                               afterCard.innerHTML = '';
                               isAnimating = false;
                           }, { once: true });

                        } else {
                           currentValue = newValue;
                           beforeCard.innerHTML = createCardContent(currentValue);
                           afterCard.innerHTML = '';
                        }
                    };

                    const handleMove = (e) => {
                        if (!isDragging || !isEnabled) return;
                        e.preventDefault();
                        const clientY = e.touches ? e.touches[0].clientY : e.clientY;
                        const deltaY = startY - clientY;
                        
                        // Change value for every 20px of drag
                        const valueChange = Math.floor(deltaY / 20);
                        if (valueChange !== 0) {
                            const newValue = currentValue + valueChange * step;
                            startY = clientY; // Reset startY to prevent cumulative changes
                            setValue(newValue, true);
                        }
                    };

                    const stopDrag = () => {
                        isDragging = false;
                        document.removeEventListener('mousemove', handleMove);
                        document.removeEventListener('mouseup', stopDrag);
                        document.removeEventListener('touchmove', handleMove);
                        document.removeEventListener('touchend', stopDrag);
                    };
                    
                    const startDrag = (e) => {
                        if (!isEnabled || isAnimating) return;
                        isDragging = true;
                        startY = e.touches ? e.touches[0].clientY : e.clientY;
                        document.addEventListener('mousemove', handleMove);
                        document.addEventListener('mouseup', stopDrag);
                        document.addEventListener('touchmove', handleMove);
                        document.addEventListener('touchend', stopDrag);
                    };

                    flipper.addEventListener('mousedown', startDrag);
                    flipper.addEventListener('touchstart', startDrag);
                    
                    setValue(initial);

                    return {
                        getValue: () => currentValue,
                        setEnabled: (enabled) => {
                            isEnabled = enabled;
                            flipper.classList.toggle('disabled', !enabled);
                        }
                    };
                }
            },
            
            // --- MODULE FOR PEDIATRIC CALCULATOR ---
            PedsCalculator: {
                 data: [
                    { medication: "Midazolam (PO)", dose: "1 mg/kg", note: "max 20mg", category: "Pre-medications", color: "orange" },
                    { medication: "Midazolam (IV)", dose: "0.1 mg/kg", note: "max 2mg", category: "Pre-medications", color: "orange" },
                    { medication: "Propofol induction (IV)", dose: "3 mg/kg", category: "Induction Medications", color: "yellow" },
                    { medication: "Ketamine induction (IV)", dose: "1 mg/kg", category: "Induction Medications", color: "yellow" },
                    { medication: "Ketamine induction (IM)", dose: "4 mg/kg", category: "Induction Medications", color: "yellow" },
                    { medication: "Lidocaine (IV)", dose: "1.5 mg/kg", note: "max 100mg", category: "Induction Medications" },
                    { medication: "Succinylcholine RSI (IV)", dose: "2 mg/kg", category: "Induction Medications", color: "red" },
                    { medication: "Succinylcholine RSI (IM)", dose: "5 mg/kg", category: "Induction Medications", color: "red" },
                    { medication: "Rocuronium (IV)", dose: "0.6 mg/kg", category: "Induction Medications", color: "red" },
                    { medication: "Rocuronium RSI (IV)", dose: "1.2 mg/kg", category: "Induction Medications", color: "red" },
                    { medication: "Tylenol (IV)", dose: "10-15 mg/kg", note: "age-dependent", category: "Pain" },
                    { medication: "Fentanyl (Intranasal)", dose: "2 mcg/kg", category: "Pain", color: "blue" },
                    { medication: "Fentanyl (IV)", dose: "1.5 mcg/kg", category: "Pain", color: "blue" },
                    { medication: "Morphine (IV)", dose: "0.05 mg/kg", category: "Pain", color: "blue" },
                    { medication: "Hydromorphone (IV)", dose: "0.015 mg/kg", category: "Pain", color: "blue" },
                    { medication: "Dexmedetomidine bolus (IV)", dose: "0.5 mcg/kg", note: "max 20mcg", category: "Pain", color: "yellow" },
                    { medication: "Ketorolac (IV)", dose: "0.5 mg/kg", note: "max 30mg", category: "Pain" },
                    { medication: "Dexamethasone (IV)", dose: "0.1 mg/kg", note: "max 10mg", category: "PONV Medications" },
                    { medication: "Ondansetron (IV)", dose: "0.15 mg/kg", note: "max 4mg", category: "PONV Medications" },
                    { medication: "Cefazolin (IV)", dose: "30 mg/kg", note: "weight-dependent max", category: "Antibiotics" },
                    { medication: "Ephedrine (IV)", dose: "0.1 mg/kg", category: "Emergency Medications", color: "purple" },
                    { medication: "Phenylephrine (IV)", dose: "1 mcg/kg", category: "Emergency Medications", color: "purple" },
                    { medication: "Epinephrine (arrest) (IV/ETT)", dose: "10 mcg/kg", category: "Emergency Medications", color: "purple" },
                    { medication: "Epinephrine (bolus or bronchospasm) (IV)", dose: "1 mcg/kg", category: "Emergency Medications", color: "purple" },
                    { medication: "Atropine (IV)", dose: "0.02 mg/kg", note: "age-dependent max", category: "Emergency Medications", color: "green" },
                    { medication: "Succinylcholine (Laryngospasm) (IV)", dose: "0.1 mg/kg", category: "Emergency Medications", color: "red" },
                    { medication: "Succinylcholine (Laryngospasm) (IM)", dose: "0.5 mg/kg", category: "Emergency Medications", color: "red" },
                    { medication: "Calcium", dose: "10 mg/kg", category: "Emergency Medications" },
                    { medication: "Propofol (Laryngospasm)", dose: "1 mg/kg", category: "Emergency Medications", color: "yellow" },
                ],
                init() {
                    this.cacheDOMElements();
                    
                    this.ageRoller = App.RollerFactory.create('age-roller-container', { label: 'Age', min: 0, max: 18, initial: 5, step: 1 });
                    this.weightRoller = App.RollerFactory.create('weight-roller-container', { label: 'Weight', min: 1, max: 150, initial: 20, step: 1, unit: 'kg' });
                    this.heightRoller = App.RollerFactory.create('height-roller-container', { label: 'Height', min: 40, max: 220, initial: 110, step: 1, unit: 'cm' });

                    this.elements.calculateBtn.addEventListener('click', () => this.calculate());
                    this.elements.pretermCheckbox.addEventListener('change', () => this.handlePreterm());
                },
                cacheDOMElements() {
                    this.elements = {
                        calculateBtn: document.getElementById('calculate-btn'),
                        ageUnitSelect: document.getElementById('age-unit'),
                        pretermCheckbox: document.getElementById('preterm-checkbox'),
                        resultsDiv: document.getElementById('results'),
                        airwayResultsDiv: document.getElementById('airway-results'),
                        vitalsResultsDiv: document.getElementById('vitals-results'),
                        medTableBody: document.getElementById('med-table-body'),
                    };
                },
                handlePreterm() {
                    const isChecked = this.elements.pretermCheckbox.checked;
                    this.ageRoller.setEnabled(!isChecked);
                    this.elements.ageUnitSelect.disabled = isChecked;
                },
                calculate() {
                    const isPreterm = this.elements.pretermCheckbox.checked;
                    const age = this.ageRoller.getValue();
                    const ageUnit = this.elements.ageUnitSelect.value;
                    const weight = this.weightRoller.getValue();
                    const height = this.heightRoller.getValue();

                    if (isNaN(weight) || weight <= 0) {
                        alert('Please enter a valid weight.');
                        return;
                    }
                    if (!isPreterm && (isNaN(age) || age < 0)) {
                         alert('Please enter a valid age.');
                         return;
                    }
                    
                    let ageInYears = isPreterm ? -1 : (ageUnit === 'years' ? age : age / 12);
                    
                    this.calculateAirway(ageInYears, height, isPreterm);
                    this.calculateVitals(ageInYears, weight, isPreterm);
                    this.calculateMedications(weight, ageInYears);

                    this.elements.resultsDiv.classList.remove('hidden');
                },
                calculateAirway(ageInYears, height, isPreterm) {
                    let ettCuffed, etDepth, laryngoscope, lma, mask;
                    let ettCuffedValueForDepth = 0;

                    if (isPreterm) {
                        ettCuffed = "2.5 - 3.0"; ettCuffedValueForDepth = 2.75;
                    } else if (ageInYears < (1/12)) {
                        ettCuffed = "3.0"; ettCuffedValueForDepth = 3.0;
                    } else if (ageInYears < 1) {
                        ettCuffed = "3.5"; ettCuffedValueForDepth = 3.5;
                    } else if (ageInYears < 12) {
                        const calculatedEtt = (ageInYears / 4) + 3.5;
                        ettCuffed = (Math.round(calculatedEtt * 2) / 2).toFixed(1);
                        ettCuffedValueForDepth = parseFloat(ettCuffed);
                    } else {
                        if (isNaN(height)) { ettCuffed = "Height required";
                        } else if (height < 150) { ettCuffed = "< 6.5";
                        } else if (height >= 150 && height < 160) { ettCuffed = "6.5"; ettCuffedValueForDepth = 6.5;
                        } else if (height >= 160 && height < 175) { ettCuffed = "7.0"; ettCuffedValueForDepth = 7.0;
                        } else if (height >= 175 && height < 185) { ettCuffed = "7.5"; ettCuffedValueForDepth = 7.5;
                        } else { ettCuffed = "8.0"; ettCuffedValueForDepth = 8.0; }
                    }

                    etDepth = ettCuffedValueForDepth > 0 ? (3 * ettCuffedValueForDepth).toFixed(1) + " cm" : "N/A";

                    if (isPreterm) laryngoscope = "Miller 00";
                    else if (ageInYears < (1/12)) laryngoscope = "Miller 0";
                    else if (ageInYears < 1) laryngoscope = "Miller 1";
                    else if (ageInYears < 4) laryngoscope = "Miller 1.5";
                    else laryngoscope = "Miller 2";

                    if (isPreterm) lma = "1";
                    else if (ageInYears < (1/12)) lma = "1";
                    else if (ageInYears < 1) lma = "1.5";
                    else if (ageInYears < 5) lma = "2";
                    else if (ageInYears < 8) lma = "2.5";
                    else lma = "3+";

                    if (isPreterm) {
                        mask = "0";
                    } else if (ageInYears < (1/12)) { // 0-1 month
                        mask = "1";
                    } else if (ageInYears < 3) { // 1 month to 2 years
                        mask = "2";
                    } else if (ageInYears < 5) { // 3-4 years
                        mask = "3";
                    } else if (ageInYears < 8) { // 5-7 years
                        mask = "4";
                    } else { // 8+ years
                        mask = "5 (Adult)";
                    }

                    this.elements.airwayResultsDiv.innerHTML = `
                        <div><dt class="text-sm font-medium text-gray-500">ETT (cuffed)</dt><dd class="mt-1 text-lg font-semibold text-indigo-600">${ettCuffed}</dd></div>
                        <div><dt class="text-sm font-medium text-gray-500">ET Depth</dt><dd class="mt-1 text-lg font-semibold text-gray-900">${etDepth}</dd></div>
                        <div><dt class="text-sm font-medium text-gray-500">Laryngoscope</dt><dd class="mt-1 text-lg font-semibold text-gray-900">${laryngoscope}</dd></div>
                        <div><dt class="text-sm font-medium text-gray-500">LMA #</dt><dd class="mt-1 text-lg font-semibold text-gray-900">${lma}</dd></div>
                        <div><dt class="text-sm font-medium text-gray-500">Mask #</dt><dd class="mt-1 text-lg font-semibold text-gray-900">${mask}</dd></div>
                    `;
                },
                calculateVitals(ageInYears, weight, isPreterm) {
                    let bp, rr, hr, ebv, hct;

                    if (isPreterm) {
                        bp = "PCA in wks"; rr = "30-60"; hr = "100-180"; ebv = 100 * weight; hct = "45 (40-55)";
                    } else if (ageInYears < (1/12)) {
                        bp = "40"; rr = "40-55"; hr = "140"; ebv = 90 * weight; hct = "55 (40-60)";
                    } else if (ageInYears < 1) {
                        bp = "40"; rr = "25-45"; hr = "120"; ebv = 80 * weight; hct = "36 (28-42)";
                    } else if (ageInYears < 4) {
                        bp = Math.round(Math.min(65, 40 + (2 * ageInYears))); rr = "18-35"; hr = "110"; ebv = 75 * weight; hct = "38 (32-45)";
                    } else if (ageInYears < 8) {
                        bp = Math.round(Math.min(65, 40 + (2 * ageInYears))); rr = "16-30"; hr = "100"; ebv = 70 * weight; hct = "38 (32-45)";
                    } else {
                        bp = Math.round(Math.min(65, 40 + (2 * ageInYears))); rr = "12-20"; hr = "80"; ebv = 70 * weight; hct = "38 (32-45)";
                    }

                    this.elements.vitalsResultsDiv.innerHTML = `
                        <div><dt class="text-sm font-medium text-gray-500">BP (MAP)</dt><dd class="mt-1 text-lg font-semibold text-gray-900">${bp}</dd></div>
                        <div><dt class="text-sm font-medium text-gray-500">RR</dt><dd class="mt-1 text-lg font-semibold text-gray-900">${rr}</dd></div>
                        <div><dt class="text-sm font-medium text-gray-500">HR</dt><dd class="mt-1 text-lg font-semibold text-gray-900">${hr}</dd></div>
                        <div><dt class="text-sm font-medium text-gray-500">EBV (mL)</dt><dd class="mt-1 text-lg font-semibold text-gray-900">${Math.round(ebv)}</dd></div>
                        <div><dt class="text-sm font-medium text-gray-500">Hct</dt><dd class="mt-1 text-lg font-semibold text-gray-900">${hct}</dd></div>
                    `;
                },
                calculateMedications(weight, ageInYears) {
                    this.elements.medTableBody.innerHTML = '';
                    let currentCategory = "";
                    const colorMap = {
                        orange: 'bg-orange-200', yellow: 'bg-yellow-200', blue: 'bg-blue-200',
                        purple: 'bg-purple-200', green: 'bg-green-200', red: 'bg-red-200'
                    };

                    this.data.forEach(med => {
                        if (med.category !== currentCategory) {
                            currentCategory = med.category;
                            const categoryRow = document.createElement('tr');
                            categoryRow.innerHTML = `<td colspan="3" class="px-6 py-3 bg-gray-200 text-sm font-bold text-gray-800">${currentCategory}</td>`;
                            this.elements.medTableBody.appendChild(categoryRow);
                        }

                        const row = document.createElement('tr');
                        const calculatedDose = this.calculateDose(med, weight, ageInYears);
                        const fullDoseString = med.note ? `${med.dose} (${med.note})` : med.dose;
                        const colorClass = med.color ? colorMap[med.color] : '';
                        
                        if (colorClass) row.classList.add(colorClass);
                        
                        row.innerHTML = `
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">${med.medication}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 font-semibold">${calculatedDose}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${fullDoseString}</td>
                        `;
                        this.elements.medTableBody.appendChild(row);
                    });
                },
                calculateDose(med, weight, ageInYears) {
                    const { medication, dose, note } = med;
                    const format = (num) => (num < 1 ? num.toFixed(2) : Math.round(num).toString());

                    // --- Special Cases ---
                    if (medication.includes("Tylenol")) {
                        const dosePerKg = ageInYears < 2 ? 10 : 15;
                        const calculatedDose = dosePerKg * weight;
                        const finalDose = Math.min(calculatedDose, 1000);
                        return `${format(finalDose)} mg`;
                    }
                    if (medication.includes("Cefazolin")) {
                        const calculatedDose = 30 * weight;
                        const maxDose = weight < 120 ? 2000 : 3000;
                        const finalDose = Math.min(calculatedDose, maxDose);
                        return `${format(finalDose)} mg`;
                    }
                    if (medication.includes("Atropine")) {
                        const calculatedDose = 0.02 * weight;
                        const maxDose = ageInYears < 12 ? 0.5 : 1.0;
                        const finalDose = Math.min(calculatedDose, maxDose);
                        return `${finalDose.toFixed(2)} mg`;
                    }

                    // --- Generic Parser ---
                    const doseMatch = dose.match(/([\d\.-]+)/g) || [];
                    const numbers = doseMatch.map(parseFloat);
                    if (numbers.length === 0) return 'N/A';

                    let calculatedDoseValue = numbers[0] * weight;

                    if (note && note.includes('max')) {
                        const maxDoseMatch = note.match(/max ([\d\.]+)/);
                        if (maxDoseMatch && maxDoseMatch[1]) {
                            const maxDose = parseFloat(maxDoseMatch[1]);
                            if (!isNaN(maxDose)) {
                                calculatedDoseValue = Math.min(calculatedDoseValue, maxDose);
                            }
                        }
                    }
                    
                    const finalDoseText = format(calculatedDoseValue);
                    const unit = (dose.match(/(mcg|mg)/) || ['unit'])[0];
                    return `${finalDoseText} ${unit}`;
                }
            },

            // --- MODULE FOR PACU MANAGEMENT ---
            PacuManager: {
                data: [
                    { symptom: "Hypertension", content: `<h3>Key Points</h3><ul><li>Definition: Systolic blood pressure (SBP) > 160 mmHg, diastolic blood pressure (DBP) > 90 mmHg, or an elevation of 20-30% above the patient's baseline.</li><li>Primary Cause: Pain is the most common cause of secondary hypertension in the PACU.</li><li>Initial Approach: Management should always be directed at identifying and treating the underlying cause before initiating antihypertensive medications.</li></ul><h3>Common Secondary Causes</h3><table><tr><th>Category</th><th>Common Causes</th></tr><tr><td>A</td><td>Analgesic deficiency (Pain), Anxiety, Autonomic dysreflexia</td></tr><tr><td>B</td><td>Bladder distension, Disordered Breathing (Hypoxia, Hypercapnia)</td></tr><tr><td>C</td><td>Catecholamines (stress response), Cold (Hypothermia)</td></tr><tr><td>D</td><td>Drugs (e.g., vasopressors, ketamine), Drug withdrawal (β-blockers, α-agonists)</td></tr><tr><td>E</td><td>Emergence excitation, Elevated Intracranial Pressure (ICP), Excessive hydration</td></tr></table>` },
                    { symptom: "Hypotension", content: `<h3>Key Points</h3><ul><li>Definition: SBP < 90 mmHg, Mean Arterial Pressure (MAP) < 60 mmHg, or a drop of 20-30% below baseline.</li><li>Primary Cause: Most postoperative hypotension is due to hypovolemia and is responsive to fluid administration.</li><li>Initial Approach: Assess for signs of inadequate organ perfusion. A fluid challenge is appropriate for most patients.</li></ul><h3>Differential Diagnosis</h3><table><tr><th>Category</th><th>Common Causes</th></tr><tr><td>Decreased Preload</td><td>Hypovolemia (hemorrhage, third-spacing), Venodilation (neuraxial/residual anesthetics), Increased intrathoracic pressure</td></tr><tr><td>Decreased Cardiac Output</td><td>Bradycardia, Tachyarrhythmias, Myocardial ischemia/infarction, Cardiac tamponade</td></tr><tr><td>Decreased SVR</td><td>Sepsis, Anaphylaxis, SIRS, Adrenal insufficiency</td></tr></table>` },
                    { symptom: "Dysrhythmia", content: `<h3>Key Points</h3><ul><li>New perioperative dysrhythmias require prompt assessment of adequacy of ventilation, hemodynamics, electrolytes, and possible cardiac ischemia.</li><li>Atrial fibrillation is common and often related to atrial stretch from volume shifts.</li><li>Many dysrhythmias are transient and require only supportive care.</li></ul><h3>Management of Stable Dysrhythmia</h3><ul><li>Stable Bradycardia: Atropine 0.5-1 mg IV.</li><li>Stable SVT: Vagal maneuvers, then Adenosine 6-12 mg IV.</li><li>Stable Atrial Fibrillation/Flutter: Rate control with Metoprolol 1-5 mg IV or Diltiazem.</li><li>Stable Wide-Complex Tachycardia: Consider VT. Amiodarone 150 mg IV over 10 min.</li></ul>` },
                    { symptom: "Hypoxia", content: `<h3>Key Points</h3><ul><li>Very Common: Hypoxia (SpO2 < 92%) is a frequent PACU event.</li><li>Primary Causes: Hypovolemia and atelectasis are the most common culprits.</li><li>Initial Response: Most cases respond to simple maneuvers and supplemental oxygen.</li></ul><h3>Common Causes</h3><table><tr><th>Category</th><th>Common Causes</th></tr><tr><td>Airway Obstruction</td><td>Tongue falling back, laryngospasm, edema, hematoma.</td></tr><tr><td>Parenchymal/Vascular</td><td>Atelectasis, pulmonary edema, pulmonary embolism, aspiration pneumonitis.</td></tr><tr><td>Ventilatory Failure</td><td>Hypoventilation from residual anesthetics, opioids, or neuromuscular blockade.</td></tr><tr><td>Other</td><td>Bronchospasm, pneumothorax.</td></tr></table>` },
                    { symptom: "Wheezing and Stridor", content: `<h3>Key Points</h3><ul><li>Stridor is an airway emergency, indicating upper airway obstruction.</li><li>Wheezing indicates lower airway obstruction (bronchoconstriction).</li><li>Distinguish the two: Stridor is a high-pitched inspiratory sound (neck). Wheezing is a musical, expiratory sound (chest).</li></ul><h3>Management</h3><ul><li>Stridor: Administer 100% O2 with CPAP. Consider racemic epinephrine, steroids. High suspicion for hematoma after neck surgery. Prepare to re-intubate.</li><li>Wheezing: Administer inhaled beta-agonist (e.g., Albuterol). Consider cause (asthma, anaphylaxis, pulmonary edema).</li></ul>` },
                    { symptom: "Delirium", content: `<h3>Key Points</h3><ul><li>Definition: An acute disturbance in attention and cognition with a fluctuating course.</li><li>Initial Approach: Rule out and correct life-threatening causes, especially hypoxia, hypotension, and hypoglycemia.</li></ul><h3>Common Reversible Causes ("PACU" Mnemonic)</h3><ul><li>P: Pain</li><li>A: Anxiety, Alcohol withdrawal</li><li>C: Constipation / Full Bladder</li><li>U: Underlying Illness (Hypoxia, Hypoglycemia, Hypotension, Infection)</li></ul>` },
                    { symptom: "Delayed Emergence", content: `<h3>Key Points</h3><ul><li>Definition: Failure to regain consciousness 30-60 minutes after the end of anesthesia.</li><li>Common Causes: Residual drug effects and metabolic disturbances.</li></ul><h3>Causes</h3><table><tr><th>Category</th><th>Common Causes</th></tr><tr><td>Pharmacologic</td><td>Residual anesthetics, Opioids, Benzodiazepines, Residual NMB.</td></tr><tr><td>Metabolic</td><td>Hypoglycemia, Hypoxia, Hypercarbia, Hypothermia.</td></tr><tr><td>Neurologic</td><td>Stroke, Seizure, Increased ICP.</td></tr></table>` },
                    { symptom: "Shivering", content: `<h3>Key Points</h3><ul><li>High Incidence: Very common after anesthesia.</li><li>Physiologic Stress: Dramatically increases oxygen consumption.</li></ul><h3>Management</h3><ol><li>Rule out other causes of shaking (rigors, seizure).</li><li>Assess core temperature. If hypothermic (<36.0°C), begin active rewarming.</li><li>Pharmacological Treatment (if normothermic): Meperidine 12.5-25 mg IV. Alternatives include Clonidine 30-75 mcg IV or Fentanyl 25-50 mcg IV.</li></ol>` },
                    { symptom: "Nausea & Vomiting (PONV)", content: `<h3>Key Points</h3><ul><li>Very Common. Leading cause of patient dissatisfaction.</li><li>Rescue Therapy: For breakthrough PONV, use an antiemetic from a different mechanistic class than the prophylactic agent(s).</li></ul><h3>Rescue Antiemetic Classes</h3><ul><li>5-HT3 Antagonist: Ondansetron</li><li>Dopamine Antagonist: Droperidol, Prochlorperazine</li><li>Antihistamine: Diphenhydramine</li><li>Steroid: Dexamethasone</li></ul>` },
                    { symptom: "Pain", content: `<h3>Key Points</h3><ul><li>Multimodal Analgesia is the Standard of Care.</li><li>Assessment is Key. Use a validated pain scale.</li></ul><h3>Approach for Severe Pain (7-10/10)</h3><ol><li>Administer small, frequent doses of a titrated IV opioid (Morphine 1-4 mg, Hydromorphone 0.2-1 mg, or Fentanyl 25-50 mcg).</li><li>Reassess pain and sedation after each dose.</li><li>Administer a non-opioid analgesic (e.g., Ketorolac 15-30 mg IV or Acetaminophen 1g IV) as a baseline.</li></ol>` }
                ],
                init() {
                    this.cacheDOMElements();
                    this.elements.searchInput.addEventListener('keyup', () => this.handleSearch());
                    document.addEventListener('click', (event) => this.hideSuggestions(event));
                },
                cacheDOMElements() {
                    this.elements = {
                        searchInput: document.getElementById('pacu-search'),
                        suggestionsBox: document.getElementById('suggestions-box'),
                        resultDisplay: document.getElementById('pacu-result-display'),
                    };
                },
                handleSearch() {
                    const query = this.elements.searchInput.value.toLowerCase();
                    this.elements.suggestionsBox.innerHTML = '';
                    if (query.length < 2) {
                        this.elements.suggestionsBox.classList.add('hidden');
                        return;
                    }

                    const filteredSymptoms = this.data.filter(item => item.symptom.toLowerCase().includes(query));

                    if (filteredSymptoms.length > 0) {
                        filteredSymptoms.forEach(item => {
                            const suggestionDiv = document.createElement('div');
                            suggestionDiv.textContent = item.symptom;
                            suggestionDiv.className = 'p-2 hover:bg-gray-100 cursor-pointer';
                            suggestionDiv.addEventListener('click', () => {
                                this.displaySymptom(item);
                                this.elements.searchInput.value = item.symptom;
                                this.elements.suggestionsBox.classList.add('hidden');
                            });
                            this.elements.suggestionsBox.appendChild(suggestionDiv);
                        });
                        this.elements.suggestionsBox.classList.remove('hidden');
                    } else {
                        this.elements.suggestionsBox.classList.add('hidden');
                    }
                },
                displaySymptom(symptom) {
                    this.elements.resultDisplay.innerHTML = `
                        <h3 class="text-xl font-bold mb-4 text-gray-800">${symptom.symptom}</h3>
                        <div class="pacu-content">${symptom.content}</div>
                    `;
                    this.elements.resultDisplay.classList.remove('hidden');
                },
                hideSuggestions(event) {
                    if (!this.elements.searchInput.contains(event.target) && !this.elements.suggestionsBox.contains(event.target)) {
                        this.elements.suggestionsBox.classList.add('hidden');
                    }
                }
            }
        };

        // --- START THE APP ---
        document.addEventListener('DOMContentLoaded', () => App.init());
    </script>
</body>
</html>



