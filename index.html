<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anesthesiology Resident Quick Guide</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            -webkit-user-select: none; /* Safari */
            -ms-user-select: none; /* IE 10+ */
            user-select: none; /* Standard syntax */
        }
        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        /* Style for the PACU content to render markdown-like headers */
        .pacu-content h1 { font-size: 1.5rem; font-weight: 700; margin-top: 1.5rem; margin-bottom: 0.5rem; border-bottom: 1px solid #e2e8f0; padding-bottom: 0.25rem; }
        .pacu-content h2 { font-size: 1.25rem; font-weight: 600; margin-top: 1.25rem; margin-bottom: 0.5rem; }
        .pacu-content h3 { font-size: 1.1rem; font-weight: 600; margin-top: 1rem; margin-bottom: 0.5rem; }
        .pacu-content p { margin-bottom: 0.75rem; line-height: 1.6; }
        .pacu-content ul { list-style-type: disc; margin-left: 1.5rem; margin-bottom: 0.75rem; }
        .pacu-content ol { list-style-type: decimal; margin-left: 1.5rem; margin-bottom: 0.75rem; }
        .pacu-content table { width: 100%; border-collapse: collapse; margin-bottom: 1rem; }
        .pacu-content th, .pacu-content td { border: 1px solid #cbd5e1; padding: 0.5rem; text-align: left; }
        .pacu-content th { background-color: #f1f5f9; }
        
        /* --- Smooth Roller Styles --- */
        .roller-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .roller-window {
            height: 60px;
            width: 100px;
            background-color: #f9fafb;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            overflow: hidden;
            position: relative;
            cursor: ns-resize;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
        }
        .roller-window.disabled {
            cursor: not-allowed;
            opacity: 0.6;
            background-color: #e5e7eb;
        }
        .roller-reel {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            transition: transform 0.2s ease-out; /* Animation */
        }
        .roller-number {
            height: 60px; /* Must match window height */
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.875rem; /* Reduced font size */
            font-weight: 700;
            color: #1f2937;
        }
        /* Fading effect for numbers outside the center */
        .roller-window::before, .roller-window::after {
            content: '';
            position: absolute;
            left: 0;
            right: 0;
            height: 20px;
            z-index: 1;
            pointer-events: none;
        }
        .roller-window::before {
            top: 0;
            background: linear-gradient(to bottom, #f9fafb, rgba(249, 250, 251, 0));
        }
        .roller-window::after {
            bottom: 0;
            background: linear-gradient(to top, #f9fafb, rgba(249, 250, 251, 0));
        }
        .roller-label {
            margin-top: 0.5rem;
            font-size: 0.875rem;
            font-weight: 500;
            color: #4b5563;
        }

        /* --- Responsive Medication Table --- */
        @media (max-width: 767px) {
            #med-table thead {
                display: none;
            }
            #med-table tbody, #med-table tr, #med-table td {
                display: block;
                width: 100%;
            }
            #med-table tr {
                margin-bottom: 1rem;
                border-bottom: 2px solid #e2e8f0;
                padding-bottom: 1rem;
            }
            #med-table tr:last-child {
                margin-bottom: 0;
                border-bottom: 0;
                padding-bottom: 0;
            }
            #med-table tr.category-row {
                border-bottom: none;
                margin-bottom: 0;
                padding-bottom: 0;
            }
            #med-table td {
                display: flex;
                justify-content: space-between;
                padding: 0.5rem 0.25rem;
                text-align: right;
                border-bottom: 1px dotted #ccc;
                 word-break: break-word;
            }
            #med-table tr.category-row td {
                display: block;
                text-align: center;
                padding: 0.75rem;
                margin-top: 1rem;
            }
            #med-table td::before {
                content: attr(data-label);
                font-weight: 600;
                text-align: left;
                padding-right: 1rem;
                flex-shrink: 0;
            }
            #med-table td:last-child {
                border-bottom: none;
            }
        }

    </style>
</head>
<body class="bg-gray-100">

    <div class="flex flex-col md:flex-row min-h-screen">
        <!-- Sidebar -->
        <aside class="w-full md:w-64 bg-gray-800 text-white flex-shrink-0">
            <div class="p-4">
                <h1 class="text-xl font-bold text-center md:text-left">Anesco Guide</h1>
                <p class="text-sm text-gray-400 text-center md:text-left">Resident Quick Reference</p>
            </div>
             <nav class="w-full">
                <div class="flex flex-row md:flex-col">
                    <!-- Tab buttons -->
                    <button id="peds-tab-btn" class="flex-grow text-center p-3 md:p-4 md:text-left border-b-4 md:border-b-0 md:border-l-4 border-indigo-500 text-white bg-gray-700 hover:bg-gray-600 focus:outline-none transition-colors duration-200">
                        Pediatric Calculator
                    </button>
                    <button id="pacu-tab-btn" class="flex-grow text-center p-3 md:p-4 md:text-left border-b-4 md:border-b-0 md:border-l-4 border-transparent text-gray-300 hover:text-white hover:bg-gray-600 focus:outline-none transition-colors duration-200">
                        PACU Management
                    </button>
                </div>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 p-4 md:p-8 overflow-y-auto">
            
            <!-- Pediatric Calculator Content -->
            <div id="peds-content">
                <h2 class="text-xl md:text-2xl font-bold mb-6 text-gray-800">Pediatric Anesthesia Calculator</h2>
                
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 items-center">
                        <div id="age-roller-container" class="roller-container"></div>
                        <div id="weight-roller-container" class="roller-container"></div>
                        <div id="height-roller-container" class="roller-container"></div>
                    </div>

                    <div class="flex justify-center mt-4">
                         <div class="flex items-center">
                            <input id="preterm-checkbox" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                            <label for="preterm-checkbox" class="ml-2 block text-sm text-gray-900">Preterm</label>
                        </div>
                        <div class="ml-4">
                             <select id="age-unit" class="rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                                <option value="years">Years</option>
                                <option value="months">Months</option>
                            </select>
                        </div>
                    </div>

                    <div class="mt-6 text-right">
                        <button id="calculate-btn" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                            Calculate
                        </button>
                    </div>
                </div>

                <div id="results" class="mt-8 hidden">
                    <h3 class="text-lg md:text-xl font-bold mb-4 text-gray-800">Results</h3>
                    <div class="bg-white p-6 rounded-lg shadow-md mb-6">
                        <h4 class="text-base md:text-lg font-semibold text-gray-700 mb-4">Airway Equipment</h4>
                        <div id="airway-results" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-4">
                            <!-- Airway results will be inserted here -->
                        </div>
                    </div>
                     <div class="bg-white p-6 rounded-lg shadow-md mb-6">
                        <h4 class="text-base md:text-lg font-semibold text-gray-700 mb-4">Vitals</h4>
                        <div id="vitals-results" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-4">
                            <!-- Vitals results will be inserted here -->
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h4 class="text-base md:text-lg font-semibold text-gray-700 mb-4">Medication Dosages</h4>
                        <div class="overflow-x-auto">
                            <table id="med-table" class="min-w-full divide-y divide-gray-200 md:divide-y-0">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Medication</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Calculated Dose</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Dose Range</th>
                                    </tr>
                                </thead>
                                <tbody id="med-table-body" class="bg-white divide-y divide-gray-200">
                                    <!-- Rows will be inserted here by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

            </div>

            <!-- PACU Management Content -->
            <div id="pacu-content" class="hidden">
                <h2 class="text-xl md:text-2xl font-bold mb-6 text-gray-800">PACU Symptom Management</h2>
                
                <div class="relative bg-white p-6 rounded-lg shadow-md">
                    <label for="pacu-search" class="block text-sm font-medium text-gray-700">Search for a symptom</label>
                    <input type="text" id="pacu-search" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm" placeholder="e.g., Hypertension, Hypoxia, Shivering...">
                    <div id="suggestions-box" class="absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg hidden">
                        <!-- Suggestions will be populated here -->
                    </div>
                </div>

                <div id="pacu-result-display" class="mt-8 bg-white p-6 rounded-lg shadow-md hidden">
                    <!-- Selected symptom content will be displayed here -->
                </div>
            </div>
        </main>
    </div>

    <script>
        const App = {
            // --- INITIALIZATION ---
            init() {
                this.cacheDOMElements();
                this.setupTabSwitching();
                this.PedsCalculator.init();
                this.PacuManager.init();
            },

            // --- DOM ELEMENT CACHING ---
            cacheDOMElements() {
                this.dom = {
                    pedsTabBtn: document.getElementById('peds-tab-btn'),
                    pacuTabBtn: document.getElementById('pacu-tab-btn'),
                    pedsContent: document.getElementById('peds-content'),
                    pacuContent: document.getElementById('pacu-content'),
                };
            },

            // --- TAB SWITCHING LOGIC ---
            setupTabSwitching() {
                this.dom.pedsTabBtn.addEventListener('click', () => {
                    this.dom.pedsContent.classList.remove('hidden');
                    this.dom.pacuContent.classList.add('hidden');
                    this.updateTabStyles(this.dom.pedsTabBtn);
                });

                this.dom.pacuTabBtn.addEventListener('click', () => {
                    this.dom.pacuContent.classList.remove('hidden');
                    this.dom.pedsContent.classList.add('hidden');
                    this.updateTabStyles(this.dom.pacuTabBtn);
                });
            },
            
            updateTabStyles(activeButton) {
                [this.dom.pedsTabBtn, this.dom.pacuTabBtn].forEach(button => {
                    button.classList.remove('border-indigo-500', 'text-white', 'bg-gray-700');
                    button.classList.add('border-transparent', 'text-gray-300');
                });
                activeButton.classList.add('border-indigo-500', 'text-white', 'bg-gray-700');
                activeButton.classList.remove('border-transparent', 'text-gray-300');
            },

            // --- ROLLER FACTORY ---
            RollerFactory: {
                create(containerId, options) {
                    const { label, min, max, initial, step = 1, unit = '' } = options;
                    const container = document.getElementById(containerId);
                    
                    container.innerHTML = `
                        <div class="roller-window" id="${containerId}-window">
                            <div class="roller-reel" id="${containerId}-reel"></div>
                        </div>
                        <span class="roller-label">${label}</span>
                    `;

                    const rollerWindow = document.getElementById(`${containerId}-window`);
                    const reel = document.getElementById(`${containerId}-reel`);
                    
                    let currentValue = initial;
                    let isDragging = false;
                    let startY = 0;
                    let startValue = 0;
                    let isEnabled = true;
                    const itemHeight = 60; // Corresponds to .roller-number height

                    // Generate the number reel
                    for (let i = min; i <= max; i += step) {
                        const numberEl = document.createElement('div');
                        numberEl.className = 'roller-number';
                        numberEl.textContent = `${i.toFixed(step < 1 ? 1 : 0)}${unit}`;
                        reel.appendChild(numberEl);
                    }

                    const setValue = (val, animate = true) => {
                        const constrainedVal = Math.max(min, Math.min(max, val));
                        const newValue = Math.round(constrainedVal / step) * step;
                        currentValue = newValue;
                        
                        const targetIndex = (newValue - min) / step;
                        const translateY = -targetIndex * itemHeight;
                        
                        reel.style.transition = animate ? 'transform 0.2s ease-out' : 'none';
                        reel.style.transform = `translateY(${translateY}px)`;
                    };

                    const handleMove = (e) => {
                        if (!isDragging || !isEnabled) return;
                        e.preventDefault(); // Prevent page scroll
                        const clientY = e.touches ? e.touches[0].clientY : e.clientY;
                        const deltaY = startY - clientY;
                        
                        const sensitivity = 5; // Lower is more sensitive
                        const valueChange = deltaY / sensitivity;
                        
                        const newValue = startValue + valueChange;
                        setValue(newValue, false); // No animation while dragging
                    };

                    const stopDrag = () => {
                        isDragging = false;
                        document.removeEventListener('mousemove', handleMove);
                        document.removeEventListener('mouseup', stopDrag);
                        document.removeEventListener('touchmove', handleMove);
                        document.removeEventListener('touchend', stopDrag);
                        // Snap to nearest value on release
                        setValue(currentValue, true);
                    };
                    
                    const startDrag = (e) => {
                        if (!isEnabled) return;
                        isDragging = true;
                        startY = e.touches ? e.touches[0].clientY : e.clientY;
                        startValue = currentValue;
                        reel.style.transition = 'none'; // Disable transition during drag
                        document.addEventListener('mousemove', handleMove);
                        document.addEventListener('mouseup', stopDrag);
                        document.addEventListener('touchmove', handleMove, { passive: false });
                        document.addEventListener('touchend', stopDrag);
                    };

                    rollerWindow.addEventListener('mousedown', startDrag);
                    rollerWindow.addEventListener('touchstart', startDrag, { passive: false });
                    
                    setValue(initial, false); // Set initial position without animation

                    return {
                        getValue: () => currentValue,
                        setEnabled: (enabled) => {
                            isEnabled = enabled;
                            rollerWindow.classList.toggle('disabled', !enabled);
                        }
                    };
                }
            },
            
            // --- MODULE FOR PEDIATRIC CALCULATOR ---
            PedsCalculator: {
                 data: [
                    { medication: "Midazolam (PO)", dose: "1 mg/kg", note: "max 20mg", category: "Pre-medications", color: "orange" },
                    { medication: "Midazolam (IV)", dose: "0.1 mg/kg", note: "max 2mg", category: "Pre-medications", color: "orange" },
                    { medication: "Propofol induction (IV)", dose: "3 mg/kg", category: "Induction Medications", color: "yellow" },
                    { medication: "Ketamine induction (IV)", dose: "1 mg/kg", category: "Induction Medications", color: "yellow" },
                    { medication: "Ketamine induction (IM)", dose: "4 mg/kg", category: "Induction Medications", color: "yellow" },
                    { medication: "Lidocaine (IV)", dose: "1.5 mg/kg", note: "max 100mg", category: "Induction Medications" },
                    { medication: "Succinylcholine RSI (IV)", dose: "2 mg/kg", category: "Induction Medications", color: "red" },
                    { medication: "Succinylcholine RSI (IM)", dose: "5 mg/kg", category: "Induction Medications", color: "red" },
                    { medication: "Rocuronium (IV)", dose: "0.6 mg/kg", category: "Induction Medications", color: "red" },
                    { medication: "Rocuronium RSI (IV)", dose: "1.2 mg/kg", category: "Induction Medications", color: "red" },
                    { medication: "Tylenol (IV)", dose: "10-15 mg/kg", note: "age-dependent", category: "Pain" },
                    { medication: "Fentanyl (Intranasal)", dose: "2 mcg/kg", category: "Pain", color: "blue" },
                    { medication: "Fentanyl (IV)", dose: "1.5 mcg/kg", category: "Pain", color: "blue" },
                    { medication: "Morphine (IV)", dose: "0.05 mg/kg", category: "Pain", color: "blue" },
                    { medication: "Hydromorphone (IV)", dose: "0.015 mg/kg", category: "Pain", color: "blue" },
                    { medication: "Dexmedetomidine bolus (IV)", dose: "0.5 mcg/kg", note: "max 20mcg", category: "Pain", color: "yellow" },
                    { medication: "Ketorolac (IV)", dose: "0.5 mg/kg", note: "max 30mg", category: "Pain" },
                    { medication: "Dexamethasone (IV)", dose: "0.1 mg/kg", note: "max 10mg", category: "PONV Medications" },
                    { medication: "Ondansetron (IV)", dose: "0.15 mg/kg", note: "max 4mg", category: "PONV Medications" },
                    { medication: "Cefazolin (IV)", dose: "30 mg/kg", note: "weight-dependent max", category: "Antibiotics" },
                    { medication: "Ephedrine (IV)", dose: "0.1 mg/kg", category: "Emergency Medications", color: "purple" },
                    { medication: "Phenylephrine (IV)", dose: "1 mcg/kg", category: "Emergency Medications", color: "purple" },
                    { medication: "Epinephrine (arrest) (IV/ETT)", dose: "10 mcg/kg", category: "Emergency Medications", color: "purple" },
                    { medication: "Epinephrine (bolus or bronchospasm) (IV)", dose: "1 mcg/kg", category: "Emergency Medications", color: "purple" },
                    { medication: "Atropine (IV)", dose: "0.02 mg/kg", note: "age-dependent max", category: "Emergency Medications", color: "green" },
                    { medication: "Succinylcholine (Laryngospasm) (IV)", dose: "0.1 mg/kg", category: "Emergency Medications", color: "red" },
                    { medication: "Succinylcholine (Laryngospasm) (IM)", dose: "0.5 mg/kg", category: "Emergency Medications", color: "red" },
                    { medication: "Calcium", dose: "10 mg/kg", category: "Emergency Medications" },
                    { medication: "Propofol (Laryngospasm)", dose: "1 mg/kg", category: "Emergency Medications", color: "yellow" },
                ],
                init() {
                    this.cacheDOMElements();
                    
                    this.ageRoller = App.RollerFactory.create('age-roller-container', { label: 'Age', min: 0, max: 18, initial: 5, step: 1 });
                    this.weightRoller = App.RollerFactory.create('weight-roller-container', { label: 'Weight', min: 1, max: 150, initial: 20, step: 1, unit: 'kg' });
                    this.heightRoller = App.RollerFactory.create('height-roller-container', { label: 'Height', min: 40, max: 220, initial: 110, step: 1, unit: 'cm' });

                    this.elements.calculateBtn.addEventListener('click', () => this.calculate());
                    this.elements.pretermCheckbox.addEventListener('change', () => this.handlePreterm());
                },
                cacheDOMElements() {
                    this.elements = {
                        calculateBtn: document.getElementById('calculate-btn'),
                        ageUnitSelect: document.getElementById('age-unit'),
                        pretermCheckbox: document.getElementById('preterm-checkbox'),
                        resultsDiv: document.getElementById('results'),
                        airwayResultsDiv: document.getElementById('airway-results'),
                        vitalsResultsDiv: document.getElementById('vitals-results'),
                        medTableBody: document.getElementById('med-table-body'),
                    };
                },
                handlePreterm() {
                    const isChecked = this.elements.pretermCheckbox.checked;
                    this.ageRoller.setEnabled(!isChecked);
                    this.elements.ageUnitSelect.disabled = isChecked;
                },
                calculate() {
                    const isPreterm = this.elements.pretermCheckbox.checked;
                    const age = this.ageRoller.getValue();
                    const ageUnit = this.elements.ageUnitSelect.value;
                    const weight = this.weightRoller.getValue();
                    const height = this.heightRoller.getValue();

                    if (isNaN(weight) || weight <= 0) {
                        alert('Please enter a valid weight.');
                        return;
                    }
                    if (!isPreterm && (isNaN(age) || age < 0)) {
                         alert('Please enter a valid age.');
                         return;
                    }
                    
                    let ageInYears = isPreterm ? -1 : (ageUnit === 'years' ? age : age / 12);
                    
                    this.calculateAirway(ageInYears, height, isPreterm);
                    this.calculateVitals(ageInYears, weight, isPreterm);
                    this.calculateMedications(weight, ageInYears);

                    this.elements.resultsDiv.classList.remove('hidden');
                },
                calculateAirway(ageInYears, height, isPreterm) {
                    let ettCuffed, etDepth, laryngoscope, lma, mask;
                    let ettCuffedValueForDepth = 0;

                    if (isPreterm) {
                        ettCuffed = "2.5 - 3.0"; ettCuffedValueForDepth = 2.75;
                    } else if (ageInYears < (1/12)) {
                        ettCuffed = "3.0"; ettCuffedValueForDepth = 3.0;
                    } else if (ageInYears < 1) {
                        ettCuffed = "3.5"; ettCuffedValueForDepth = 3.5;
                    } else if (ageInYears < 12) {
                        const calculatedEtt = (ageInYears / 4) + 3.5;
                        ettCuffed = (Math.round(calculatedEtt * 2) / 2).toFixed(1);
                        ettCuffedValueForDepth = parseFloat(ettCuffed);
                    } else {
                        if (isNaN(height)) { 
                            ettCuffed = "Height required";
                        } else if (height < 160) { 
                            ettCuffed = "6.5"; ettCuffedValueForDepth = 6.5;
                        } else if (height >= 160 && height < 175) { 
                            ettCuffed = "7.0"; ettCuffedValueForDepth = 7.0;
                        } else if (height >= 175 && height < 185) { 
                            ettCuffed = "7.5"; ettCuffedValueForDepth = 7.5;
                        } else { 
                            ettCuffed = "8.0"; ettCuffedValueForDepth = 8.0; 
                        }
                    }

                    etDepth = ettCuffedValueForDepth > 0 ? (3 * ettCuffedValueForDepth).toFixed(1) + " cm" : "N/A";

                    if (isPreterm) laryngoscope = "Miller 00";
                    else if (ageInYears < (1/12)) laryngoscope = "Miller 0";
                    else if (ageInYears < 1) laryngoscope = "Miller 1";
                    else if (ageInYears < 4) laryngoscope = "Miller 1.5";
                    else laryngoscope = "Miller 2";

                    if (isPreterm) lma = "1";
                    else if (ageInYears < (1/12)) lma = "1";
                    else if (ageInYears < 1) lma = "1.5";
                    else if (ageInYears < 5) lma = "2";
                    else if (ageInYears < 8) lma = "2.5";
                    else lma = "3+";

                    if (isPreterm) {
                        mask = "0";
                    } else if (ageInYears < (1/12)) { // 0-1 month
                        mask = "1";
                    } else if (ageInYears < 3) { // 1 month to 2 years
                        mask = "2";
                    } else if (ageInYears < 5) { // 3-4 years
                        mask = "3";
                    } else if (ageInYears < 8) { // 5-7 years
                        mask = "4";
                    } else { // 8+ years
                        mask = "5 (Adult)";
                    }

                    this.elements.airwayResultsDiv.innerHTML = `
                        <div><dt class="text-sm font-medium text-gray-500">ETT (cuffed)</dt><dd class="mt-1 text-lg font-semibold text-indigo-600">${ettCuffed}</dd></div>
                        <div><dt class="text-sm font-medium text-gray-500">ET Depth</dt><dd class="mt-1 text-lg font-semibold text-gray-900">${etDepth}</dd></div>
                        <div><dt class="text-sm font-medium text-gray-500">Laryngoscope</dt><dd class="mt-1 text-lg font-semibold text-gray-900">${laryngoscope}</dd></div>
                        <div><dt class="text-sm font-medium text-gray-500">LMA #</dt><dd class="mt-1 text-lg font-semibold text-gray-900">${lma}</dd></div>
                        <div><dt class="text-sm font-medium text-gray-500">Mask #</dt><dd class="mt-1 text-lg font-semibold text-gray-900">${mask}</dd></div>
                    `;
                },
                calculateVitals(ageInYears, weight, isPreterm) {
                    let bp, rr, hr, ebv, hct;

                    if (isPreterm) {
                        bp = "PCA in wks"; rr = "30-60"; hr = "100-180"; ebv = 100 * weight; hct = "45 (40-55)";
                    } else if (ageInYears < (1/12)) {
                        bp = "40"; rr = "40-55"; hr = "140"; ebv = 90 * weight; hct = "55 (40-60)";
                    } else if (ageInYears < 1) {
                        bp = "40"; rr = "25-45"; hr = "120"; ebv = 80 * weight; hct = "36 (28-42)";
                    } else if (ageInYears < 4) {
                        bp = Math.round(Math.min(65, 40 + (2 * ageInYears))); rr = "18-35"; hr = "110"; ebv = 75 * weight; hct = "38 (32-45)";
                    } else if (ageInYears < 8) {
                        bp = Math.round(Math.min(65, 40 + (2 * ageInYears))); rr = "16-30"; hr = "100"; ebv = 70 * weight; hct = "38 (32-45)";
                    } else {
                        bp = Math.round(Math.min(65, 40 + (2 * ageInYears))); rr = "12-20"; hr = "80"; ebv = 70 * weight; hct = "38 (32-45)";
                    }

                    this.elements.vitalsResultsDiv.innerHTML = `
                        <div><dt class="text-sm font-medium text-gray-500">BP (MAP)</dt><dd class="mt-1 text-lg font-semibold text-gray-900">${bp}</dd></div>
                        <div><dt class="text-sm font-medium text-gray-500">RR</dt><dd class="mt-1 text-lg font-semibold text-gray-900">${rr}</dd></div>
                        <div><dt class="text-sm font-medium text-gray-500">HR</dt><dd class="mt-1 text-lg font-semibold text-gray-900">${hr}</dd></div>
                        <div><dt class="text-sm font-medium text-gray-500">EBV (mL)</dt><dd class="mt-1 text-lg font-semibold text-gray-900">${Math.round(ebv)}</dd></div>
                        <div><dt class="text-sm font-medium text-gray-500">Hct</dt><dd class="mt-1 text-lg font-semibold text-gray-900">${hct}</dd></div>
                    `;
                },
                calculateMedications(weight, ageInYears) {
                    this.elements.medTableBody.innerHTML = '';
                    let currentCategory = "";
                    const colorMap = {
                        orange: 'bg-orange-200', yellow: 'bg-yellow-200', blue: 'bg-blue-200',
                        purple: 'bg-purple-200', green: 'bg-green-200', red: 'bg-red-200'
                    };

                    this.data.forEach(med => {
                        if (med.category !== currentCategory) {
                            currentCategory = med.category;
                            const categoryRow = document.createElement('tr');
                            categoryRow.className = 'category-row';
                            categoryRow.innerHTML = `<td colspan="3" class="px-6 py-3 bg-gray-200 text-sm font-bold text-gray-800">${currentCategory}</td>`;
                            this.elements.medTableBody.appendChild(categoryRow);
                        }

                        const row = document.createElement('tr');
                        const calculatedDose = this.calculateDose(med, weight, ageInYears);
                        const fullDoseString = med.note ? `${med.dose} (${med.note})` : med.dose;
                        const colorClass = med.color ? colorMap[med.color] : '';
                        
                        if (colorClass) row.classList.add(colorClass);
                        
                        row.innerHTML = `
                            <td data-label="Medication" class="px-6 py-4 whitespace-nowrap text-sm font-medium">${med.medication}</td>
                            <td data-label="Calculated Dose" class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 font-semibold">${calculatedDose}</td>
                            <td data-label="Dose Range" class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${fullDoseString}</td>
                        `;
                        this.elements.medTableBody.appendChild(row);
                    });
                },
                calculateDose(med, weight, ageInYears) {
                    const { medication, dose, note } = med;
                    const format = (num) => (num < 1 ? num.toFixed(2) : Math.round(num).toString());

                    // --- Special Cases ---
                    if (medication.includes("Tylenol")) {
                        const dosePerKg = ageInYears < 2 ? 10 : 15;
                        const calculatedDose = dosePerKg * weight;
                        const finalDose = Math.min(calculatedDose, 1000);
                        return `${format(finalDose)} mg`;
                    }
                    if (medication.includes("Cefazolin")) {
                        const calculatedDose = 30 * weight;
                        const maxDose = weight < 120 ? 2000 : 3000;
                        const finalDose = Math.min(calculatedDose, maxDose);
                        return `${format(finalDose)} mg`;
                    }
                    if (medication.includes("Atropine")) {
                        const calculatedDose = 0.02 * weight;
                        const maxDose = ageInYears < 12 ? 0.5 : 1.0;
                        const finalDose = Math.min(calculatedDose, maxDose);
                        return `${finalDose.toFixed(2)} mg`;
                    }

                    // --- Generic Parser ---
                    const doseMatch = dose.match(/([\d\.-]+)/g) || [];
                    const numbers = doseMatch.map(parseFloat);
                    if (numbers.length === 0) return 'N/A';

                    let calculatedDoseValue = numbers[0] * weight;

                    if (note && note.includes('max')) {
                        const maxDoseMatch = note.match(/max ([\d\.]+)/);
                        if (maxDoseMatch && maxDoseMatch[1]) {
                            const maxDose = parseFloat(maxDoseMatch[1]);
                            if (!isNaN(maxDose)) {
                                calculatedDoseValue = Math.min(calculatedDoseValue, maxDose);
                            }
                        }
                    }
                    
                    const finalDoseText = format(calculatedDoseValue);
                    const unit = (dose.match(/(mcg|mg)/) || ['unit'])[0];
                    return `${finalDoseText} ${unit}`;
                }
            },

            // --- MODULE FOR PACU MANAGEMENT ---
            PacuManager: {
                data: [
                    { symptom: "Hypertension", content: `<h3>Definition</h3><p>Systolic blood pressure > 160 mmHg, Diastolic blood pressure > 90 mmHg, or an elevation of 20-30% above baseline</p><h3>Differential Diagnosis</h3><ul><li>Pain</li><li>Anxiety</li><li>Hypoxemia</li><li>Hypercarbia</li><li>Bladder distention</li><li>Hypothermia/shivering</li><li>Pre-existing essential hypertension</li><li>Fluid overload</li><li>Increased ICP</li><li>Autonomic hyperreflexia</li><li>Drug-induced (ketamine, vasopressors, cocaine)</li><li>Withdrawal (beta-blockers, alpha-agonists, alcohol)</li></ul><h3>Management</h3><ol><li>Verify BP measurement (check cuff size, measure manually).</li><li>Assess patient for signs of end-organ damage (chest pain, altered mental status).</li><li>Treat underlying cause.</li><li>If treatment is necessary, consider short-acting, titratable agents.</li></ol><h3>Decision Tree</h3><table><tr><th>Condition</th><th>Treatment</th></tr><tr><td>Pain</td><td>Analgesics</td></tr><tr><td>Anxiety</td><td>Anxiolytics</td></tr><tr><td>Hypoxemia/Hypercarbia</td><td>Supplemental O2, ventilatory support</td></tr><tr><td>Bladder distention</td><td>Foley catheter</td></tr><tr><td>Tachycardia present</td><td>Labetalol 5-20 mg IV q10min (max 300 mg) or Esmolol 0.5 mg/kg load, then 50-300 mcg/kg/min</td></tr><tr><td>Tachycardia absent</td><td>Hydralazine 5-20 mg IV q20min</td></tr></table>` },
                    { symptom: "Hypotension", content: `<h3>Definition</h3><p>Systolic blood pressure < 90 mmHg, Mean arterial pressure < 60 mmHg, or a drop of 20-30% below baseline</p><h3>Differential Diagnosis</h3><ul><li>Hypovolemia (hemorrhage, inadequate fluid replacement, diuresis)</li><li>Decreased cardiac output (bradycardia, arrhythmias, ischemia, tamponade, PE)</li><li>Decreased systemic vascular resistance (sepsis, anaphylaxis, neuraxial anesthesia, residual anesthetic agents, adrenal insufficiency)</li></ul><h3>Management</h3><ol><li>Assess for signs of inadequate perfusion.</li><li>Administer 100% oxygen.</li><li>Fluid challenge (250-500 mL crystalloid) unless contraindicated.</li><li>Treat underlying cause.</li></ol><h3>Decision Tree</h3><table><tr><th>Suspected Cause</th><th>Treatment</th></tr><tr><td>Hypovolemia</td><td>Fluid bolus, blood products if hemorrhage</td></tr><tr><td>Bradycardia</td><td>Atropine, Ephedrine</td></tr><tr><td>Reduced SVR</td><td>Phenylephrine 50-100 mcg IV bolus, Ephedrine 5-10 mg IV bolus</td></tr><tr><td>Cardiogenic</td><td>Inotropes (Epinephrine, Dobutamine), consult cardiology</td></tr><tr><td>Anaphylaxis</td><td>Epinephrine, fluids, antihistamines, steroids</td></tr></table>` },
                    { symptom: "Tachycardia", content: `<h3>Definition</h3><p>Heart rate > 100 bpm in adults</p><h3>Differential Diagnosis</h3><ul><li>Pain, anxiety, shivering</li><li>Hypovolemia, hypotension</li><li>Hypoxemia, hypercarbia</li><li>Fever, sepsis</li><li>Anemia</li><li>PE, MI, cardiac tamponade</li><li>Drug-induced (atropine, epinephrine, cocaine)</li><li>Withdrawal (beta-blockers)</li></ul><h3>Management</h3><ol><li>Assess hemodynamic stability.</li><li>Administer 100% oxygen.</li><li>Obtain 12-lead EKG.</li><li>Treat underlying cause.</li></ol><h3>Decision Tree</h3><table><tr><th>EKG Finding</th><th>Treatment</th></tr><tr><td>Narrow Complex, Regular (SVT)</td><td>Vagal maneuvers, then Adenosine 6-12 mg IV</td></tr><tr><td>Narrow Complex, Irregular (A-fib)</td><td>Rate control: Metoprolol 2.5-5 mg IV or Diltiazem 0.25 mg/kg IV</td></tr><tr><td>Wide Complex, Regular (VT)</td><td>Amiodarone 150 mg IV over 10 min, synchronized cardioversion if unstable</td></tr><tr><td>Sinus Tachycardia</td><td>Treat underlying cause (e.g., fluids for hypovolemia, analgesics for pain)</td></tr></table>` },
                    { symptom: "Bradycardia", content: `<h3>Definition</h3><p>Heart rate < 60 bpm in adults</p><h3>Differential Diagnosis</h3><ul><li>Vagal stimulation</li><li>Increased ICP</li><li>Hypoxemia</li><li>Hypothermia</li><li>Drug-induced (opioids, beta-blockers, calcium channel blockers, succinylcholine)</li><li>High spinal/epidural anesthesia</li><li>Myocardial infarction</li></ul><h3>Management</h3><ol><li>Assess hemodynamic stability.</li><li>Administer 100% oxygen.</li><li>Review medication administration record.</li></ol><h3>Decision Tree</h3><table><tr><th>Condition</th><th>Treatment</th></tr><tr><td>Asymptomatic, stable</td><td>Observe, treat underlying cause</td></tr><tr><td>Symptomatic (hypotension, altered mental status)</td><td>Atropine 0.5-1 mg IV q3-5min (max 3 mg)</td></tr><tr><td>Atropine ineffective</td><td>Epinephrine infusion (2-10 mcg/min) or Dopamine infusion (5-20 mcg/kg/min)</td></tr><tr><td>Severe/Refractory</td><td>Transcutaneous pacing</td></tr></table>` },
                    { symptom: "Dysrhythmia", content: `<h3>See Tachycardia and Bradycardia sections for specific management.</h3><h3>General Principles</h3><ul><li>Assess ABCs and hemodynamic stability first.</li><li>Administer 100% O2.</li><li>Obtain 12-lead EKG and check electrolytes (K+, Mg++, Ca++).</li><li>Many postoperative dysrhythmias are transient and related to reversible causes.</li></ul>` },
                    { symptom: "Hypoxia", content: `<h3>Definition</h3><p>SpO2 < 92%</p><h3>Differential Diagnosis</h3><ul><li>Airway Obstruction (tongue, laryngospasm, edema, foreign body)</li><li>Hypovilation (residual anesthetics, opioids, neuromuscular blockade)</li><li>Atelectasis</li><li>Pulmonary Edema (cardiogenic vs. non-cardiogenic/negative pressure)</li><li>Aspiration</li><li>Bronchospasm</li><li>Pneumothorax</li><li>Pulmonary Embolism</li></ul><h3>Management</h3><ol><li>Administer 100% oxygen via face mask.</li><li>Ensure airway patency (jaw thrust, chin lift, oral/nasal airway).</li><li>Assess breath sounds.</li><li>Stimulate patient to breathe deeply.</li></ol><h3>Decision Tree</h3><table><tr><th>Finding</th><th>Suspected Cause & Action</th></tr><tr><td>No air movement, inspiratory stridor</td><td>Airway obstruction -> Reposition airway, consider re-intubation</td></tr><tr><td>Decreased breath sounds at bases</td><td>Atelectasis -> Encourage coughing, deep breathing, incentive spirometry</td></tr><tr><td>Wheezing</td><td>Bronchospasm -> Albuterol nebulizer, IV steroids</td></tr><tr><td>Rales, pink frothy sputum</td><td>Pulmonary Edema -> Diuretics (furosemide), positive pressure ventilation</td></tr><tr><td>Unilateral absent breath sounds, tracheal deviation</td><td>Pneumothorax -> Needle decompression, chest tube</td></tr></table>` },
                    { symptom: "Hypercarbia", content: `<h3>Definition</h3><p>Increased end-tidal CO2, respiratory acidosis on ABG</p><h3>Differential Diagnosis</h3><ul><li>Hypoventilation (most common cause)</li><li>Residual anesthetic agents, opioids, benzodiazepines</li><li>Residual neuromuscular blockade</li><li>Airway obstruction</li><li>Increased CO2 production (fever, sepsis, shivering, malignant hyperthermia)</li><li>Equipment malfunction (rebreathing)</li></ul><h3>Management</h3><ol><li>Increase supplemental oxygen.</li><li>Ensure airway patency and assist ventilation if necessary.</li><li>Reverse residual drug effects (naloxone for opioids, flumazenil for benzos, neostigmine/sugammadex for NMB).</li><li>Treat underlying cause of increased CO2 production.</li></ol>` },
                    { symptom: "Wheezing and Stridor", content: `<h3>Definitions</h3><ul><li><b>Wheezing:</b> Musical, high-pitched sound, usually expiratory, indicating lower airway obstruction.</li><li><b>Stridor:</b> Harsh, high-pitched inspiratory sound indicating upper airway obstruction. <b>Stridor is an airway emergency.</b></li></ul><h3>Differential Diagnosis</h3><ul><li><b>Wheezing:</b> Bronchospasm, asthma, anaphylaxis, pulmonary edema, aspiration.</li><li><b>Stridor:</b> Laryngospasm, laryngeal edema, subglottic stenosis, vocal cord paralysis, foreign body, hematoma.</li></ul><h3>Management</h3><table><tr><th>Condition</th><th>Actions</th></tr><tr><td>Stridor</td><td>1. 100% O2 with CPAP/PEEP.<br>2. Racemic epinephrine nebulizer.<br>3. Dexamethasone 4-10 mg IV.<br>4. Prepare for immediate re-intubation. Consider smaller ETT.</td></tr><tr><td>Wheezing</td><td>1. Inhaled beta-agonist (Albuterol).<br>2. IV corticosteroids (hydrocortisone, methylprednisolone).<br>3. Epinephrine if anaphylaxis is suspected.</td></tr></table>` },
                    { symptom: "Delirium", content: `<h3>Definition</h3><p>Acute disturbance in attention and cognition with a fluctuating course.</p><h3>Differential Diagnosis (Mnemonic: I WATCH DEATH)</h3><ul><li><b>I</b>nfection</li><li><b>W</b>ithdrawal</li><li><b>A</b>cute metabolic (acidosis, electrolyte imbalance)</li><li><b>T</b>rauma</li><li><b>C</b>NS pathology</li><li><b>H</b>ypoxia</li><li><b>D</b>eficiencies (thiamine)</li><li><b>E</b>ndocrinopathies</li><li><b>A</b>cute vascular</li><li><b>T</b>oxins or drugs</li><li><b>H</b>eavy metals</li></ul><p><b>Most common PACU causes:</b> Hypoxia, hypercarbia, hypotension, hypoglycemia, pain, bladder distention, residual anesthetic agents.</p><h3>Management</h3><ol><li>Rule out and correct life-threatening causes first.</li><li>Provide supportive care: reorientation, quiet environment.</li><li>Treat underlying cause.</li><li>For severe agitation: Haloperidol 0.5-2 mg IV/IM or Dexmedetomidine infusion. Avoid benzodiazepines.</li></ol>` },
                    { symptom: "Delayed Emergence", content: `<h3>Definition</h3><p>Failure to regain consciousness 30-60 minutes after discontinuation of anesthesia.</p><h3>Differential Diagnosis</h3><ul><li><b>Pharmacologic (most common):</b> Residual inhalational agents, IV anesthetics, opioids, benzodiazepines, neuromuscular blockade.</li><li><b>Metabolic:</b> Hypoglycemia, hypoxia, hypercarbia, electrolyte abnormalities, hypothermia.</li><li><b>Neurologic:</b> Stroke, seizure, increased ICP, intracranial hemorrhage.</li></ul><h3>Management</h3><ol><li>Support ventilation and circulation.</li><li>Review anesthetic record for drug doses and timing.</li><li>Check blood glucose.</li><li>Consider reversal agents: Naloxone for opioids, Flumazenil for benzodiazepines, Neostigmine/Sugammadex for NMB.</li><li>If cause remains unclear, obtain neurologic consultation and consider head CT.</li></ol>` },
                    { symptom: "Shivering", content: `<h3>Pathophysiology</h3><p>Involuntary, oscillating muscle activity to increase heat production. Can increase oxygen consumption by 200-500%.</p><h3>Differential Diagnosis</h3><ul><li>Hypothermia (core temperature < 36°C)</li><li>Non-thermoregulatory shivering (pain, stress response)</li><li>Rigors from sepsis or drug reaction</li><li>Seizure activity</li></ul><h3>Management</h3><ol><li>Assess core temperature.</li><li><b>If hypothermic:</b> Apply forced-air warming blanket.</li><li><b>If normothermic:</b><br> - Meperidine 12.5-25 mg IV (treatment of choice).<br> - Alternatives: Clonidine 30-75 mcg IV, Fentanyl 25-50 mcg IV, Ondansetron 4 mg IV.</li></ol>` },
                    { symptom: "Nausea & Vomiting (PONV)", content: `<h3>Risk Factors</h3><p>Female gender, non-smoker, history of PONV/motion sickness, postoperative opioids, volatile anesthetics.</p><h3>Management</h3><h4>Prophylaxis</h4><p>Consider multimodal approach for high-risk patients (e.g., dexamethasone + ondansetron).</p><h4>Rescue Therapy</h4><p>Use an antiemetic from a different class than the prophylactic agent(s).</p><table><tr><th>Drug Class</th><th>Examples</th></tr><tr><td>5-HT3 Antagonist</td><td>Ondansetron 4 mg IV</td></tr><tr><td>Dopamine Antagonist</td><td>Prochlorperazine 5-10 mg IV, Droperidol 0.625-1.25 mg IV</td></tr><tr><td>Antihistamine</td><td>Diphenhydramine 12.5-25 mg IV</td></tr><tr><td>Steroid</td><td>Dexamethasone 4 mg IV (slower onset)</td></tr><tr><td>Anticholinergic</td><td>Scopolamine patch (prophylaxis only)</td></tr></table>` },
                    { symptom: "Pain", content: `<h3>Assessment</h3><p>Use a validated pain scale (e.g., Numeric Rating Scale 0-10). Assess pain at rest and with movement.</p><h3>Management</h3><p>Utilize a multimodal approach.</p><h4>Severe Pain (NRS 7-10)</h4><ol><li>Administer small, frequent doses of titrated IV opioids:<br>- Fentanyl 25-50 mcg q5-10min<br>- Hydromorphone 0.2-0.5 mg q10-15min<br>- Morphine 1-4 mg q10-15min</li><li>Reassess pain and sedation frequently.</li><li>Administer a non-opioid analgesic as a baseline.</li></ol><h4>Non-Opioid Adjuncts</h4><ul><li>Acetaminophen 1000 mg IV/PO</li><li>Ketorolac 15-30 mg IV (use with caution in renal dysfunction, bleeding risk)</li><li>Ketamine 0.1-0.3 mg/kg IV slow bolus</li><li>Regional anesthesia techniques (if applicable)</li></ul>` },
                    { symptom: "Oliguria", content: `<h3>Definition</h3><p>Urine output < 0.5 mL/kg/hr</p><h3>Differential Diagnosis</h3><h4>Pre-renal (most common)</h4><ul><li>Hypovolemia</li><li>Hypotension</li><li>Decreased cardiac output</li></ul><h4>Renal</h4><ul><li>Acute tubular necrosis (ATN) from prolonged ischemia or nephrotoxins</li></ul><h4>Post-renal</h4><ul><li>Blocked or kinked Foley catheter</li><li>Surgical obstruction of ureters</li></ul><h3>Management</h3><ol><li>Check Foley catheter for patency. Flush if necessary.</li><li>Assess volume status (vitals, physical exam).</li><li>Administer a fluid challenge (250-500 mL crystalloid) if patient is not fluid overloaded.</li><li>If no response to fluids and patient is euvolemic, consider furosemide 10-20 mg IV.</li></ol>` },
                    { symptom: "Fever", content: `<h3>Definition</h3><p>Core temperature > 38°C (100.4°F)</p><h3>Differential Diagnosis</h3><h4>Immediate (in PACU)</h4><ul><li>Pre-existing infection</li><li>Surgical stress response</li><li>Blood transfusion reaction</li><li>Malignant hyperthermia (MH) - <b>Must be ruled out</b></li><li>Drug fever</li></ul><h4>Delayed (within hours to days)</h4><ul><li>Atelectasis (less common cause than previously thought)</li><li>Pneumonia</li><li>UTI</li><li>Surgical site infection</li></ul><h3>Management</h3><ol><li>If MH is suspected (tachycardia, hypercarbia, rigidity, hyperthermia), initiate MH protocol immediately.</li><li>Administer antipyretics (Acetaminophen 1000 mg IV/PO).</li><li>Draw blood cultures if infection is suspected.</li><li>Provide cooling measures (ice packs, cooling blanket).</li></ol>` },
                    { symptom: "Malignant Hyperthermia", content: `<h3>This is a life-threatening emergency.</h3><h3>Signs & Symptoms</h3><ul><li>Unexpected rise in end-tidal CO2 (earliest, most sensitive sign)</li><li>Tachycardia, tachypnea</li><li>Muscle rigidity (especially masseter muscle)</li><li>Hyperthermia (late sign)</li><li>Cola-colored urine (myoglobinuria)</li><li>Arrhythmias</li><li>Metabolic acidosis</li></ul><h3>Immediate Management (Call for help)</h3><ol><li><b>Discontinue all triggering agents</b> (volatile anesthetics, succinylcholine). Hyperventilate with 100% O2.</li><li><b>Administer Dantrolene 2.5 mg/kg IV push.</b> Repeat q5-10min until symptoms resolve (max 10 mg/kg).</li><li>Treat hyperkalemia (calcium, insulin/glucose, bicarbonate).</li><li>Cool the patient (gastric lavage, surface cooling).</li><li>Treat arrhythmias (avoid calcium channel blockers).</li><li>Obtain ABG, electrolytes, CK, myoglobin.</li><li>Admit to ICU.</li></ol>` },
                    { symptom: "Anaphylaxis", content: `<h3>Definition</h3><p>A severe, life-threatening, generalized or systemic hypersensitivity reaction.</p><h3>Signs & Symptoms</h3><ul><li><b>Cutaneous:</b> Urticaria, flushing, angioedema (often first signs)</li><li><b>Respiratory:</b> Bronchospasm, wheezing, stridor, hypoxemia</li><li><b>Cardiovascular:</b> Hypotension, tachycardia, cardiovascular collapse</li></ul><h3>Management (Call for help)</h3><ol><li><b>Stop the offending agent.</b></li><li><b>Administer 100% oxygen.</b> Secure the airway if needed.</li><li><b>Epinephrine is the first-line treatment.</b><br>- For hypotension: 10-100 mcg IV boluses.<br>- For cardiovascular collapse: 0.5-1 mg IV push.</li><li><b>Administer fluids aggressively</b> (1-2 L crystalloid).</li><li><b>Second-line treatments:</b><br>- H1 Blocker: Diphenhydramine 25-50 mg IV<br>- H2 Blocker: Famotidine 20 mg IV<br>- Corticosteroids: Hydrocortisone 100-200 mg IV or Methylprednisolone 1-2 mg/kg IV</li></ol>` },
                    { symptom: "Transfusion Reaction", content: `<h3>Types & Symptoms</h3><ul><li><b>Allergic/Urticarial:</b> Hives, pruritus.</li><li><b>Febrile Non-Hemolytic:</b> Fever, chills, headache.</li><li><b>Acute Hemolytic (most severe):</b> Fever, chills, hypotension, hemoglobinuria (red urine), flank pain, DIC.</li><li><b>TRALI (Transfusion-Related Acute Lung Injury):</b> Acute hypoxemia and bilateral pulmonary edema within 6 hours of transfusion.</li><li><b>TACO (Transfusion-Associated Circulatory Overload):</b> Hypertension, tachycardia, pulmonary edema in at-risk patients.</li></ul><h3>Immediate Management</h3><ol><li><b>Stop the transfusion immediately.</b></li><li>Maintain IV access but change the tubing.</li><li>Notify the blood bank.</li><li>Send untransfused blood and patient blood/urine samples to the lab.</li><li>Provide supportive care (fluids, pressors for hypotension; diuretics for TACO).</li></ol>` },
                    { symptom: "Local Anesthetic Systemic Toxicity (LAST)", content: `<h3>Definition</h3><p>Systemic toxicity resulting from high plasma concentrations of local anesthetics, typically after regional anesthesia.</p><h3>Signs & Symptoms</h3><ul><li><b>CNS (often first):</b> Lightheadedness, tinnitus, perioral numbness, metallic taste, muscle twitching, visual disturbances, progressing to seizures and coma.</li><li><b>Cardiovascular:</b> Hypertension and tachycardia initially, progressing to bradycardia, ventricular arrhythmias, and asystole.</li></ul><h3>Management (Call for help)</h3><ol><li><b>Stop injecting the local anesthetic.</b></li><li><b>Maintain airway and ventilate with 100% O2.</b></li><li>Treat seizures with benzodiazepines (e.g., Midazolam 1-2 mg IV). Avoid Propofol in hemodynamically unstable patients.</li><li><b>Administer 20% Lipid Emulsion Therapy:</b><br>- Bolus: 1.5 mL/kg over 1 minute.<br>- Infusion: 0.25 mL/kg/min.<br>- May repeat bolus once or twice for persistent cardiovascular collapse.</li><li>Initiate ACLS if arrest occurs, but use smaller epinephrine doses (e.g., < 1 mcg/kg).</li></ol>` },
                    { symptom: "Seizure", content: `<h3>Differential Diagnosis</h3><ul><li>Epilepsy</li><li>Metabolic (hypoglycemia, hyponatremia)</li><li>Hypoxia</li><li>Drug-induced (LAST, withdrawal, meperidine)</li><li>Stroke, intracranial hemorrhage</li></ul><h3>Management</h3><ol><li><b>Protect the patient from injury.</b> Turn patient to the side.</li><li><b>Maintain airway and provide 100% O2.</b></li><li>Check blood glucose immediately.</li><li><b>Terminate seizure activity:</b><br>- Propofol 20-50 mg IV<br>- Midazolam 1-2 mg IV or Lorazepam 1-2 mg IV</li><li>Investigate and treat the underlying cause.</li></ol>` },
                    { symptom: "Stroke", content: `<h3>Signs & Symptoms</h3><p>Acute onset of focal neurologic deficit (e.g., facial droop, arm weakness, speech difficulty).</p><h3>Immediate Management</h3><ol><li><b>Call a "Stroke Alert" or "Code Stroke".</b></li><li>Maintain ABCs, provide supplemental O2.</li><li>Check blood glucose.</li><li>Maintain normotension (avoid aggressive BP reduction unless SBP > 220).</li><li><b>Immediate non-contrast head CT</b> to differentiate ischemic vs. hemorrhagic.</li><li>Neurology and/or neurosurgery consultation.</li></ol>` },
                    { symptom: "Myocardial Infarction", content: `<h3>Signs & Symptoms</h3><p>Chest pain/pressure, shortness of breath, diaphoresis, nausea, radiation of pain to arm/jaw. Symptoms may be atypical in postoperative patients.</p><h3>Management</h3><ol><li><b>Obtain 12-lead EKG immediately.</b></li><li>Administer 100% O2.</li><li><b>Aspirin 324 mg chewed.</b></li><li>Nitroglycerin 0.4 mg sublingual (if SBP > 90).</li><li>Morphine for pain relief.</li><li>Obtain cardiac enzymes (Troponin).</li><li><b>Immediate cardiology consultation.</b></li></ol>` },
                    { symptom: "Pulmonary Embolism", content: `<h3>Signs & Symptoms</h3><p>Sudden onset of dyspnea, pleuritic chest pain, tachycardia, hypoxemia. Massive PE can cause hypotension and cardiac arrest.</p><h3>Management</h3><ol><li>Administer 100% O2.</li><li>Support hemodynamics with fluids and vasopressors.</li><li>Obtain EKG (may show S1Q3T3 pattern) and ABG.</li><li><b>Anticoagulation with heparin</b> is the primary treatment.</li><li><b>Consider CT Angiogram</b> for diagnosis.</li><li>For massive PE with instability, consider thrombolysis or embolectomy.</li></ol>` },
                    { symptom: "Aspiration", content: `<h3>Definition</h3><p>Inhalation of gastric contents into the lungs.</p><h3>Signs & Symptoms</h3><p>Acute hypoxemia, bronchospasm, coughing, wheezing, rales. May be silent.</p><h3>Management</h3><ol><li>Place patient in Trendelenburg and turn head to the side.</li><li>Suction the oropharynx.</li><li>Administer 100% O2.</li><li>If large particles are aspirated, perform bronchoscopy.</li><li>Monitor for development of aspiration pneumonitis. Prophylactic antibiotics are not recommended.</li></ol>` },
                    { symptom: "Pneumothorax", content: `<h3>Signs & Symptoms</h3><p>Sudden chest pain, dyspnea, decreased breath sounds on one side, hypoxemia. Tension pneumothorax presents with hypotension, tracheal deviation, and JVD.</p><h3>Management</h3><ol><li>Administer 100% O2.</li><li>Obtain chest X-ray.</li><li><b>Tension Pneumothorax is a clinical diagnosis and requires immediate needle decompression</b> (2nd intercostal space, midclavicular line) followed by chest tube insertion.</li><li>Simple pneumothorax may be observed or require chest tube depending on size and symptoms.</li></ol>` },
                    { symptom: "Negative Pressure Pulmonary Edema", content: `<h3>Pathophysiology</h3><p>Forceful inspiration against a closed glottis (e.g., laryngospasm) creates highly negative intrathoracic pressure, leading to fluid shift into the alveoli.</p><h3>Signs & Symptoms</h3><p>Acute respiratory distress and hypoxemia after an airway obstruction event. Pink, frothy sputum is common.</p><h3>Management</h3><ol><li>Relieve the airway obstruction.</li><li>Administer 100% O2.</li><li><b>Apply CPAP or BiPAP.</b></li><li>Diuretics (e.g., Furosemide) may be helpful.</li><li>Most cases resolve quickly with supportive care, but may require re-intubation.</li></ol>` },
                    { symptom: "Laryngospasm", content: `<h3>Definition</h3><p>A reflex closure of the vocal cords that obstructs the airway.</p><h3>Management</h3><ol><li>Administer 100% O2 with a tight-fitting mask.</li><li><b>Apply positive pressure (CPAP) via bag-mask.</b></li><li>Apply firm pressure at the "laryngospasm notch" (behind the earlobe).</li><li>Deepen anesthesia with Propofol 0.5-1 mg/kg IV.</li><li>If unresolved, give Succinylcholine 0.1-0.5 mg/kg IV or 4 mg/kg IM.</li><li>Be prepared to re-intubate.</li></ol>` },
                    { symptom: "Bronchospasm", content: `<h3>See "Wheezing and Stridor" section.</h3>` },
                    { symptom: "Residual Neuromuscular Blockade", content: `<h3>Signs & Symptoms</h3><p>Shallow breathing, "rocking boat" respiratory pattern, poor head lift (>5 sec), weak hand grip, diplopia, difficulty swallowing.</p><h3>Management</h3><ol><li>Ensure adequate ventilation and oxygenation.</li><li><b>Administer reversal agent:</b><br>- Sugammadex (for rocuronium/vecuronium)<br>- Neostigmine 0.03-0.07 mg/kg with Glycopyrrolate 0.2 mg per 1 mg of neostigmine.</li><li>Monitor closely until full recovery of muscle strength.</li></ol>` },
                    { symptom: "Amniotic Fluid Embolism", content: `<h3>Definition</h3><p>A rare, catastrophic complication of pregnancy where amniotic fluid enters maternal circulation.</p><h3>Signs & Symptoms</h3><p>Sudden cardiovascular collapse, profound hypoxemia, and severe coagulopathy (DIC) during labor or shortly after delivery.</p><h3>Management (Call for help)</h3><ol><li>Initiate high-quality CPR if arrest occurs.</li><li>Intubate and provide 100% O2.</li><li>Aggressive hemodynamic support with fluids and vasopressors.</li><li><b>Treat coagulopathy with massive transfusion protocol.</b></li><li>Consider A-OK protocol (Atropine, Ondansetron, Ketorolac).</li></ol>` },
                    { symptom: "Post-dural Puncture Headache (PDPH)", content: `<h3>Signs & Symptoms</h3><p>Headache that is worse when upright and relieved by lying flat. Often occipital or frontal, associated with neck stiffness, nausea, and photophobia. Typically occurs 24-48 hours after dura puncture.</p><h3>Management</h3><ol><li>Conservative: Bed rest, hydration, caffeine.</li><li>Analgesics: Acetaminophen, NSAIDs.</li><li><b>Epidural Blood Patch is the definitive treatment.</b> 15-20 mL of autologous blood is injected into the epidural space.</li></ol>` },
                    { symptom: "High Spinal", content: `<h3>Definition</h3><p>Cephalad spread of local anesthetic in the subarachnoid space after spinal anesthesia, leading to high sensory/motor block and cardiovascular compromise.</p><h3>Signs & Symptoms</h3><p>Progressive numbness/weakness in upper extremities, dyspnea, hypotension, bradycardia, leading to apnea and cardiac arrest.</p><h3>Management</h3><ol><li>Recognize early symptoms (e.g., dyspnea).</li><li>Administer 100% O2, be prepared to intubate.</li><li>Treat hypotension aggressively with fluids and vasopressors (phenylephrine, ephedrine).</li><li>Treat bradycardia with atropine, ephedrine, or epinephrine.</li><li>Reassure the patient.</li></ol>` },
                    { symptom: "Hematoma after Neck Surgery", content: `<h3>This is a surgical and airway emergency.</h3><h3>Signs & Symptoms</h3><p>Neck swelling, pain, tracheal deviation, stridor, respiratory distress after procedures like thyroidectomy or carotid endarterectomy.</p><h3>Management (Call for help)</h3><ol><li><b>Call the surgeon immediately.</b></li><li>Administer 100% O2.</li><li><b>At the bedside, immediately open the surgical staples/sutures to evacuate the hematoma and relieve pressure.</b> Do not wait.</li><li>Prepare for a difficult intubation.</li></ol>` },
                    { symptom: "Postoperative Vision Loss (POVL)", content: `<h3>A rare but devastating complication.</h3><h3>Causes</h3><ul><li><b>Ischemic Optic Neuropathy (ION):</b> Most common cause. Associated with prolonged hypotension, anemia, large blood loss, and prone positioning (especially spinal surgery).</li><li><b>Central Retinal Artery Occlusion (CRAO):</b> Associated with direct ocular pressure.</li></ul><h3>Prevention is key. No effective treatment once it occurs.</h3>` },
                    { symptom: "Compartment Syndrome", content: `<h3>Definition</h3><p>Increased pressure within a fascial compartment leading to tissue ischemia.</p><h3>Signs & Symptoms (The 6 P's)</h3><p>Pain out of proportion to injury, Paresthesias, Pallor, Paralysis, Pulselessness, Poikilothermia (coolness).</p><h3>Management</h3><ol><li>Remove any constricting dressings or casts.</li><li>Elevate the limb to the level of the heart (not above).</li><li><b>Immediate surgical consultation for fasciotomy.</b></li></ol>` },
                    { symptom: "Venous Air Embolism", content: `<h3>Definition</h3><p>Entrainment of air into the venous circulation.</p><h3>Signs & Symptoms</h3><p>Sudden drop in end-tidal CO2, hypotension, "mill-wheel" murmur on precordial doppler, hypoxemia.</p><h3>Management</h3><ol><li>Notify surgeon to flood the surgical field with saline.</li><li>Place patient in Trendelenburg and left lateral decubitus position (Durant's maneuver).</li><li>Administer 100% O2.</li><li>Attempt to aspirate air from a central venous catheter if present.</li><li>Provide hemodynamic support.</li></ol>` },
                    { symptom: "Hyponatremia / TURP Syndrome", content: `<h3>Definition</h3><p>Acute hyponatremia and fluid overload from absorption of hypotonic irrigation fluid (e.g., during TURP).</p><h3>Signs & Symptoms</h3><p>Headache, confusion, nausea, visual disturbances, progressing to seizures and coma. Hypertension and bradycardia may be present.</p><h3>Management</h3><ol><li>Stop the procedure if possible.</li><li>Fluid restriction.</li><li>Administer loop diuretics (Furosemide).</li><li>For severe neurologic symptoms, administer <b>hypertonic saline (3%)</b> slowly. Correct sodium by no more than 8-10 mEq/L in 24 hours to avoid central pontine myelinolysis.</li></ol>` },
                    { symptom: "Hypoglycemia", content: `<h3>Definition</h3><p>Blood glucose < 70 mg/dL. Neurologic symptoms appear < 50 mg/dL.</p><h3>Signs & Symptoms</h3><p>Diaphoresis, tachycardia, anxiety, confusion, seizure, coma. Beta-blockers can mask symptoms.</p><h3>Management</h3><ol><li><b>If awake:</b> Give 15g of oral carbohydrates.</li><li><b>If unconscious/NPO:</b> Give 25g of 50% dextrose (D50W) IV.</li><li>Recheck blood glucose in 15 minutes.</li></ol>` },
                    { symptom: "Hyperglycemia", content: `<h3>Definition</h3><p>Blood glucose > 180 mg/dL.</p><h3>Management</h3><ol><li>Administer IV regular insulin according to a sliding scale or infusion protocol.</li><li>Check electrolytes, especially potassium.</li><li>Ensure adequate hydration with IV fluids.</li><li>Monitor for development of DKA or HHS.</li></ol>` },
                    { symptom: "Adrenal Insufficiency", content: `<h3>Definition</h3><p>Inability of the adrenal glands to produce adequate cortisol, especially in response to stress.</p><h3>Signs & Symptoms</h3><p>Refractory hypotension despite fluids and vasopressors, nausea, vomiting, weakness, hypoglycemia, hyponatremia, hyperkalemia.</p><h3>Management</h3><ol><li>Draw a random cortisol level.</li><li><b>Administer stress-dose steroids: Hydrocortisone 100 mg IV.</b></li><li>Provide aggressive fluid and vasopressor support.</li></ol>` },
                    { symptom: "Thyroid Storm", content: `<h3>Definition</h3><p>A life-threatening manifestation of hyperthyroidism.</p><h3>Signs & Symptoms</h3><p>Hyperthermia, tachycardia, hypertension, delirium, heart failure.</p><h3>Management (Call for help)</h3><ol><li>Cooling measures.</li><li>Beta-blockers (Propranolol, Esmolol) for heart rate control.</li><li>Antithyroid drugs (Propylthiouracil - PTU).</li><li>Iodine solution (after PTU).</li><li>Corticosteroids (Hydrocortisone).</li></ol>` },
                    { symptom: "Diabetic Ketoacidosis (DKA)", content: `<h3>Definition</h3><p>A triad of hyperglycemia (>250), metabolic acidosis (pH < 7.3, bicarb < 18), and ketonemia.</p><h3>Management</h3><ol><li><b>Aggressive IV fluid resuscitation</b> with normal saline.</li><li><b>Regular insulin infusion</b> (0.1 units/kg/hr). Do not bolus.</li><li>Monitor and replace electrolytes, especially potassium.</li><li>Continue insulin infusion until acidosis resolves and anion gap closes.</li></ol>` },
                    { symptom: "Acid-Base Disturbances", content: `<h3>Quick Guide</h3><table><tr><th>Disturbance</th><th>Primary Change</th><th>Compensation</th><th>Common Causes</th></tr><tr><td>Resp. Acidosis</td><td>↑ PaCO2</td><td>↑ HCO3</td><td>Hypovilation</td></tr><tr><td>Resp. Alkalosis</td><td>↓ PaCO2</td><td>↓ HCO3</td><td>Hyperventilation (pain, anxiety)</td></tr><tr><td>Met. Acidosis</td><td>↓ HCO3</td><td>↓ PaCO2</td><td>Lactic acidosis, DKA, renal failure</td></tr><tr><td>Met. Alkalosis</td><td>↑ HCO3</td><td>↑ PaCO2</td><td>Vomiting, diuretics, citrate toxicity</td></tr></table><h3>Management</h3><p>Treat the underlying cause.</p>` },
                    { symptom: "Hyperkalemia", content: `<h3>Definition</h3><p>Potassium > 5.5 mEq/L.</p><h3>EKG Changes</h3><p>Peaked T waves, wide QRS, loss of P waves, sine wave pattern.</p><h3>Management</h3><ol><li><b>Stabilize membrane: Calcium gluconate 1g IV.</b></li><li><b>Shift K+ intracellularly:</b><br>- Insulin 10 units IV with D50W 25g.<br>- Sodium bicarbonate 50 mEq IV.<br>- Albuterol nebulizer.</li><li><b>Eliminate K+:</b><br>- Furosemide<br>- Kayexalate<br>- Dialysis (definitive treatment)</li></ol>` },
                    { symptom: "Hypokalemia", content: `<h3>Definition</h3><p>Potassium < 3.5 mEq/L.</p><h3>EKG Changes</h3><p>U waves, flattened T waves, ST depression.</p><h3>Management</h3><p>Replace potassium cautiously. IV replacement should not exceed 10-20 mEq/hr on a monitored unit. Remember to check magnesium levels, as hypomagnesemia makes hypokalemia difficult to correct.</p>` },
                    { symptom: "Hypocalcemia", content: `<h3>Signs & Symptoms</h3><p>Paresthesias, muscle cramps, Chvostek's sign (facial twitch), Trousseau's sign (carpopedal spasm), laryngospasm, seizures, QT prolongation.</p><h3>Management</h3><p><b>Symptomatic:</b> Calcium gluconate 1-2g IV over 10 minutes.<br><b>Asymptomatic:</b> Oral calcium supplementation.</p>` },
                    { symptom: "Hypomagnesemia", content: `<h3>Signs & Symptoms</h3><p>Weakness, muscle fasciculations, tetany, seizures. Associated with hypokalemia and hypocalcemia. Can lead to Torsades de Pointes.</p><h3>Management</h3><p><b>Non-emergent:</b> Magnesium sulfate 1-2g IV over 1 hour.<br><b>Torsades de Pointes:</b> Magnesium sulfate 2g IV push over 1-2 minutes.</p>` },
                    { symptom: "PACU Discharge Criteria (Aldrete Score)", content: `<h3>A score of ≥9 is typically required for discharge.</h3><table><tr><th>Criteria</th><th>Score 2</th><th>Score 1</th><th>Score 0</th></tr><tr><td><b>Activity</b></td><td>Moves all 4 extremities</td><td>Moves 2 extremities</td><td>Moves 0 extremities</td></tr><tr><td><b>Respiration</b></td><td>Breathes deeply and coughs freely</td><td>Dyspnea or limited breathing</td><td>Apneic</td></tr><tr><td><b>Circulation</b></td><td>BP ± 20% of pre-anesthetic level</td><td>BP ± 20-49% of pre-anesthetic level</td><td>BP ± 50% of pre-anesthetic level</td></tr><tr><td><b>Consciousness</b></td><td>Fully awake</td><td>Arousable on calling</td><td>Not responding</td></tr><tr><td><b>O2 Saturation</b></td><td>SpO2 > 92% on room air</td><td>Needs O2 to maintain SpO2 > 90%</td><td>SpO2 < 90% even with O2</td></tr></table>` },
                ],
                init() {
                    this.cacheDOMElements();
                    this.elements.searchInput.addEventListener('keyup', () => this.handleSearch());
                    document.addEventListener('click', (event) => this.hideSuggestions(event));
                },
                cacheDOMElements() {
                    this.elements = {
                        searchInput: document.getElementById('pacu-search'),
                        suggestionsBox: document.getElementById('suggestions-box'),
                        resultDisplay: document.getElementById('pacu-result-display'),
                    };
                },
                stripHtml(html) {
                    let tmp = document.createElement("DIV");
                    tmp.innerHTML = html;
                    return tmp.textContent || tmp.innerText || "";
                },
                handleSearch() {
                    const query = this.elements.searchInput.value.toLowerCase().trim();
                    this.elements.suggestionsBox.innerHTML = '';
                    if (query.length < 2) {
                        this.elements.suggestionsBox.classList.add('hidden');
                        return;
                    }

                    const searchRegex = new RegExp(query.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&'), 'gi');

                    const rankedSymptoms = this.data.map(item => {
                        const plainContent = this.stripHtml(item.content);
                        const titleMatches = (item.symptom.match(searchRegex) || []).length;
                        const contentMatches = (plainContent.match(searchRegex) || []).length;
                        
                        const score = (titleMatches * 10) + contentMatches;

                        return { ...item, score };
                    })
                    .filter(item => item.score > 0)
                    .sort((a, b) => b.score - a.score);


                    if (rankedSymptoms.length > 0) {
                        rankedSymptoms.slice(0, 10).forEach(item => { // Show top 10 results
                            const suggestionDiv = document.createElement('div');
                            suggestionDiv.textContent = item.symptom;
                            suggestionDiv.className = 'p-2 hover:bg-gray-100 cursor-pointer';
                            suggestionDiv.addEventListener('click', () => {
                                this.displaySymptom(item);
                                this.elements.searchInput.value = item.symptom;
                                this.elements.suggestionsBox.classList.add('hidden');
                            });
                            this.elements.suggestionsBox.appendChild(suggestionDiv);
                        });
                        this.elements.suggestionsBox.classList.remove('hidden');
                    } else {
                        this.elements.suggestionsBox.classList.add('hidden');
                    }
                },
                displaySymptom(symptom) {
                    this.elements.resultDisplay.innerHTML = `
                        <h3 class="text-xl font-bold mb-4 text-gray-800">${symptom.symptom}</h3>
                        <div class="pacu-content">${symptom.content}</div>
                    `;
                    this.elements.resultDisplay.classList.remove('hidden');
                },
                hideSuggestions(event) {
                    if (!this.elements.searchInput.contains(event.target) && !this.elements.suggestionsBox.contains(event.target)) {
                        this.elements.suggestionsBox.classList.add('hidden');
                    }
                }
            }
        };

        // --- START THE APP ---
        document.addEventListener('DOMContentLoaded', () => App.init());
    </script>
</body>
</html>

